//#-p stonebrick 0 -b 443 10 -321 -print
///	C:\Users\Austin\Documents\Austin\powder game code\eGO\Events & Commands\Races\ECR - Ever Changing Race\CBP_EverChangingRace.cbp

//<Defines
DEFINE $CMDName$ ECR
DEFINE $CMDSizeX$ 10
DEFINE $CMDSizeY$ 6
DEFINE $CMDSizeZ$ 16

DEFINE $Style$ 0 16 16
DEFINE $SA$ x=450,y=0,z=-353,dx=124,dy=30,dz=45

///	Name
DEFINE $Name$ EC
///	Text display name
DEFINE $TD$ ECR
///	Hover and scoreboard name
DEFINE $TDName$ Ever Changing Race
///	Scoreboard teams color
DEFINE $Color$ yellow
///	Place where air is when open
DEFINE $Dao$ 
///	Place where redstone blocks are there when open
DEFINE $Dro$ 
///	Spawn Coords for teleporting
DEFINE $SC$ 460 3 -331 -90 0
///	Spawn Coords ID
DEFINE $SPid$ 20

///	Where laps are completed
DEFINE $lap$ x=565,y=3,z=-333,dy=3,dz=4
///	Area where laps are reset inside the races
DEFINE $lapAF$ x=497,y=0,z=-333,dy=4,dz=4
///	Area where laps are disabled in spawn
DEFINE $lapSP$ x=454,y=2,z=-334,dx=12,dy=9,dz=6

DEFINE DEF_SBlock structure_block 0 replace {mode:"LOAD",posZ:2,name:"ECRPlatform1",integrity:|0|}

///	Smiley Heads coordinates
DEFINE $SHead$ 466 4 -329 466 4 -333

///	ECR Armor Stand placement for structure blocks
DEFINE $ECRStructure1$ 467 3 -335
DEFINE $ECRStructure2$ 499 3 -335
DEFINE $ECRStructure3$ 531 3 -335

///	Select Death
DEFINE $ECRKill$ x=467,y=0,z=-333,dx=95,dy=-5,dz=4
///	Coordinates of the platform
DEFINE $ECRPlatform$ 467 2 -329 562 2 -333
///	Number of custom death messages
DEFINE $DeathMessages$ 13

///	Percent list
DEFINE $ECRPercent1$ 5
DEFINE $ECRPercent2$ 10
DEFINE $ECRPercent3$ 15
DEFINE $ECRPercent4$ 20
DEFINE $ECRPercent5$ 25
DEFINE $ECRPercent6$ 30
DEFINE $ECRPercent7$ 35
DEFINE $ECRPercent8$ 40
DEFINE $ECRPercent9$ 45
DEFINE $ECRPercent10$ 50
DEFINE $ECRPercent11$ 100

///	Portal
DEFINE $Portal$ x=569,y=3,z=-333,dy=4,dz=4

PCBPIMPORT PCBPI_PosRZ.txt
//>

//<Comments
FUNC Func_Comments
	Delay 1
	0.5
	1
	1.5
	2
	2.5
	3
	3.5
	4
	4.5
	5

	Delay 2
	0.5
	1
	1.5
	2
	2.5

///	Options
	On/off lever
	Text on/off lever
	EVERYONE LINE UP bcast button
	Delay 1 sign (x2)
	Delay 2 sign (x2)
	Percentage sign (x2)
	Display sign

ECRSave: Delay1, Delay2, Percent
END
//>


//<Main Start
FUNC Func_EditGeneralScoreboardStart
///	Scoreboards
	USE $ObjA$
		$Name$RaceDS dummy $TDName$ Delay State
		$Name$RaceTI dummy $TDName$ Delay Timer
		$Name$RaceDE2 deathCount Deaths
		ECRSave dummy ECR Settings Save
	UNUSE
	ExecuteSpawnStand scoreboard objectives setdisplay belowName $Name$RaceDE2
	
///	ECR Armor Stands
	ExecuteSpawnStand summon ArmorStand ~ ~ ~ {Marker:1,PersistenceRequired:1,Invisible:1,NoGravity:1,Tags:["ECRAS","ECRRaceTimer"]}
	ExecuteSpawnStand summon ArmorStand ~ ~ ~ {Marker:1,PersistenceRequired:1,Invisible:1,NoGravity:1,Tags:["ECRAS","ECRDeathMessages"]}
	LOOP 1 3 + 1
		ExecuteSpawnStand summon ArmorStand $ECRStructure|0|$ {Marker:1,PersistenceRequired:1,Invisible:1,NoGravity:1,Tags:["ECRAS","ECRStructure","ECRStructure|0|"]}
	END
	@e[type=ArmorStand,ECRDeathMessages] $Name$RaceTI + 0
	
	@a[$SA$,EC=0] SPbk = $SPid$
END
//>

//<Main Clock
FUNC Func_EditGeneralScoreboardClock
///	Book
	@a[$SA$,m=2,$Name$RaceDE>=1,EC=0] SPbk = $SPid$

///	Portal
	ScTG @a[$Portal$,m=2,team=ECR] add ECRKilled
	
///	Custom death messages
	ScTG @a[$ECRKill$,m=2,team=ECR,!ECRKilled] add ECRKilled
///	$s$kill @a[$ECRKill$,m=2,team=ECR,ECRKilled]
///	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI>=0<$DeathMessages$] $Name$RaceTI + 1
///	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=$DeathMessages$] $Name$RaceTI = 0
	$s$tp @a[$SA$,m=2,team=ECR,ECRKilled] $SC$
	@a[$SA$,m=2,team=ECR,ECRKilled] playsound minecraft:entity.endermen.teleport voice @a[c=1]
	@a[$SA$,m=2,team=ECR,ECRKilled] particle happyVillager ~0.1 ~1 ~0.1 0.3 0.5 0.3 1 20 force
	effect @a[$SA$,m=2,team=ECR,ECRKilled] 8 5 255 true
	RevST(ECRKilled)
	
///	Fills stuff
	@e[type=ArmorStand,ECRRaceTimer,$Name$RaceTI>=1] $Name$RaceTI - 1
	testfor @e[type=ArmorStand,ECRRaceTimer,$Name$RaceTI=0,$Name$RaceDS=1]
	CONSTART
		ScOP @e[type=ArmorStand,ECRRaceTimer,$Name$RaceTI=0,$Name$RaceDS=1] $Name$RaceTI = Delay2 ECRSave
		@e[type=ArmorStand,ECRRaceTimer,$Name$RaceDS=1] $Name$RaceDS = 2
		Activate(CBPStructureBlockPulse)
	CONEND
	
	@e[type=ArmorStand,ECRRaceTimer,$Name$RaceTI=0,$Name$RaceDS=2] fill $ECRPlatform$ air 0 replace gold_block 0
	@e[type=ArmorStand,ECRRaceTimer,$Name$RaceTI=0,$Name$RaceDS=2] fill $ECRPlatform$ gold_block 0 replace stained_glass 3
	
	testfor @e[type=ArmorStand,ECRRaceTimer,$Name$RaceTI=0,$Name$RaceDS=2]
	CONSTART
		ScOP @e[type=ArmorStand,ECRRaceTimer,$Name$RaceTI=0,$Name$RaceDS=2] $Name$RaceTI = Delay1 ECRSave
		@e[type=ArmorStand,ECRRaceTimer,$Name$RaceDS=2] $Name$RaceDS = 1
	CONEND
END
//>
	
//<Death Messages Testfor Clock
FUNC Func_DeathMessagesTFClock
	testfor @a[m=2,team=ECR,ECRKilled]
	SetblockTestfor
	
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=1] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" experienced Smiley\'s wrath and spontaneously combusted"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=2] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" accidentally dropped their car keys and jumped for it"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=3] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" slipped on a banana"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=4] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" realized they had lost some potential, but gained kinetic energy"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=5] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" thought there was water underneath"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=6] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" ignored the wet floor sign"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=7] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" figured out what happens if you can\'t fly"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=8] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" heard one of MisterBoy\'s puns"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=9] @a[m=2,team=ECR,ECRKilled,name=!Sooperhampster] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" had a fear of heights and looked down"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=9] @a[m=2,team=ECR,ECRKilled,name=Sooperhampster] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" realized he was not so sooper after all"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=10] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" tried to be a gold block, but suddenly remembered they cannot float"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=11] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" was banned from the server"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=12] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" heard a panda roar"}]}
	@e[type=ArmorStand,ECRDeathMessages,$Name$RaceTI=13] @a[m=2,team=ECR,ECRKilled] tellraw @a $TextStart${"selector":"@a[c=1,m=2,ECRKilled]"},{"text":" thought they were playing a dropper map"}]}
	
	ScTG @a[ECRKilled] remove ECRKilled
END
//>

//<Structure Block Pulse
FUNC Func_StructureBlockPulse
	ScOP @e[type=ArmorStand,ECRRaceTimer] ECRSave = Percent ECRSave
	LOOP 1 11 + 1
		@e[type=ArmorStand,ECRRaceTimer,ECRSave=$ECRPercent|0|$] @e[type=ArmorStand,ECRStructure] setblock ~ ~-1 ~ DEF_SBlock(DIV($ECRPercent|0|$;100.0))
	END
	@e[type=ArmorStand,ECRStructure] setblock ~ ~ ~ redstone_block 0
	@e[type=ArmorStand,ECRStructure] setblock ~ ~ ~ air 0
	@a[$SA$] playsound minecraft:entity.experience_orb.touch voice @a[c=1] ~ ~ ~ 0.4
END
//>

//<Countdown Clock
FUNC Func_EditCountdownClock
	@e[type=AreaEffectCloud,$Name$RaceCD,$Name$RaceCD=120] @e[type=ArmorStand,ECRRaceTimer] $Name$RaceDS = 1
	@e[type=AreaEffectCloud,$Name$RaceCD,$Name$RaceCD=120] @e[type=ArmorStand,ECRRaceTimer] $Name$RaceTI = 0
	@e[type=AreaEffectCloud,$Name$RaceCD,$Name$RaceCD=120] fill $SHead$ air 0
END
//>

//<Main End
FUNC Func_EditGeneralScoreboardEnd
///	Scoreboard
	USE $ObjR$
		$Name$RaceDS
		$Name$RaceTI
		$Name$RaceDE2
	UNUSE
	ScTG * remove ECRKilled
	@a[EC=0] SPbk = $SPid$
	
///	Other
	$s$kill @e[type=ArmorStand,tag=ECRAS]
	fill $SHead$ skull 4 replace {SkullType:3,Owner:{Name:"Smiley0_1",Id:"15f83218-25b3-4936-873e-20fd1aede94c"}}
	fill $ECRPlatform$ air 0
END

PCBPIMPORT PCBPI_LapRaceGroup.txt
//>

//<Groups
Func_CMDSave()

:CBPMainStart PULSE $Style$
Func_SpawnStandStart()
Deactivate(CBPMainStart)
Func_GeneralScoreboardStart()
Func_EditGeneralScoreboardStart()
Activate(CBPMainClock)
Activate(CBPCountdown)
FinalSpawnStand

:CBPMainClock CLOCK $Style$
Func_SpawnIDSetting()
Func_GeneralScoreboardClock()

:CBPCountdown CLOCK $Style$
Func_CountdownClock()
Func_EditCountdownClock()

:CBPStructureBlockPulse PULSE $Style$
Deactivate(CBPStructureBlockPulse)
Func_StructureBlockPulse()

:CBPMainEnd PULSE $Style$
Func_SpawnStandEnd()
Deactivate(CBPMainEnd)
Func_GeneralScoreboardEnd()
Func_EditGeneralScoreboardEnd()
Deactivate(CBPMainClock)
Deactivate(CBPCountdown)
//>













