//#-p stonebrick 0 -b 15 4 -17 -print
///	C:\Users\Austin\Documents\Austin\powder game code\eGO\Events & Commands\Other\Mailbox\PCBP_Mailbox.cbp

//<Defines
DEFINE $s$ minecraft:
DEFINE $ObjA$ scoreboard objectives add
DEFINE $ObjR$ scoreboard objectives remove
DEFINE $TeamA$ scoreboard teams add
DEFINE $TeamO$ scoreboard teams option
DEFINE $TeamR$ scoreboard teams remove
DEFINE $Style$ 16 16 0
DEFINE $SA$ x=#,y=#,z=#,dx=#,dy=#,dz=#
DEFINE $TextStart$ {"text":"","extra":[{"text":"[","color":"gray"},{"text":"NAME","color":"COLOR","bold":"true","hoverEvent":{"action":"show_text","value":{"text":"NAME","color":"COLOF"}}},{"text":"]","color":"gray"},{"text":": "},

DEFINE Deactivate fill |0| stonebrick 0
DEFINE Activate fill |0| redstone_block 0
DEFINE ColorFillWool fill |0| wool |1|
DEFINE ColorFillClay fill |0| stained_hardened_clay |1|
DEFINE ColorFillGlass fill |0| stained_glass |1|
DEFINE ColorFillWood fill |0| wood |1|
DEFINE ScTG scoreboard players tag
DEFINE ScOP scoreboard players operation
DEFINE ScTE scoreboard players test
DEFINE ScRS scoreboard players reset
DEFINE RevST scoreboard players tag @a[|0|] remove |0|
DEFINE SetblockTestfor setblock ~ ~ ~ repeating_command_block 13 replace {TrackOutput:0b,auto:1b}
DEFINE NumberAdd |0| Number = |0|
DEFINE NumberObjAdd Number dummy

///	Arbitrary password longer than 30 characters
DEFINE $Password$ thp7tr7epod0-s7ywa37hrotlkodsry8943wmxdsf38

///	Select Entrance
DEFINE $Entrance$ x=267,y=3,z=-133,r=6
DEFINE $FillEntrance$ 271 7 -131 268 4 -138

///	Button Placement
DEFINE $ButtonGoIn$ 266 4 -133 stone_button 2
DEFINE $ButtonGoOut$ 268 4 -133

/// Bottom corner of the mailbox
DEFINE $ArmorStandCoords$ 288 16 -144

DEFINE $FillLoad$ 16 11 0 16 11 24

DEFINE $FillSave$ 16 14 0 16 14 24

DEFINE $LoadChest$ 18 4 -6
DEFINE $FillAll$ 16 16 0 25 45 25
DEFINE $SaveChest$ 18 4 -6 18 4 -5
//>

//<Comments
FUNC Func_RandomComments
	-max 10 received mailboxes
	-signs will be copyed over unless they request to be anonymous
	
	-when leavegame = 1, teleports out, tellraw, set state to 0
	-also leaves team
	
	-when on team, can view current player score via setdisplay sidebar
END
//>

//<To Do 
FUNC Func_ToDoThings
TDWorks TDTest TDFix
Mandatory Unimplemented Changes:
	-
	
General Unimplemented Changes:
	-
	
Bugs:
	-
	
Implemented Changes:
	-
	
Bug fixes:
	-
	
END
//>



//<General Scoreboard Start
FUNC Func_GeneralScoreboardStart
	USE $ObjA$
		NumberObjAdd
		MBdi dummy Mailbox Display
		MBid dummy Mailbox ID
		MBis dummy Mailbox ID Save
		MBst dummy Mailbox State
		MBsn dummy Mailbox Sign
		MBtp dummy Mailbox Teleport
		MBti dummy Mailbox Timer
		MBop dummy Mailbox Option
	UNUSE
	
	USE $TeamA$
		MBw
	UNUSE
	
	USE $TeamO$
		MBw color white
	UNUSE
	
///	MBst 0 = Transfer from storage
///	MBst 1 = Transfer to storage
	scoreboard objectives setdisplay sidebar.team.white MBdi
	
	summon ArmorStand ~ ~ ~ {Tags:["MailboxEntity","MailboxStand"],Invulnerable:1,PersistenceRequired:1,Invisible:1,Marker:1,NoGravity:1}
	@e[type=ArmorStand,MailboxStand] MBtp = 0
END
//>

//<General Scoreboard Clock
FUNC Func_GeneralScoreboardClock
///	Gamemode
	$s$gamemode 2 @a[$SA$,m=0]
	$s$gamemode 0 @a[$Entrance$,m=2]

///	PID
	@a MBid + 0
	@a[MBid=0,c=1] PlayerNumber MBid + 1
	ScOP @a[MBid=0,c=1] MBid = PlayerNumber MBid
	
///	Timer
	@e[type=ArmorStand,MailboxCalc,MBti>=1] MBti + 1
	@e[type=ArmorStand,MailboxCalc,MBti<=-1] MBti - 1
	
	testfor @e[type=ArmorStand,MailboxCalc,MBti=5]
	CONDITION
		Activate(CBPChestCalcLoad2)
		
	testfor @e[type=ArmorStand,MailboxCalc,MBti=-5]
	CONDITION
		Activate(CBPChestCalcSave2)
	
	testfor @e[type=ArmorStand,MailboxCalc,MBti=-10]
	CONDITION
		Activate(CBPChestCalcSave3)
END
//>

//<Mailbox Enter Pulse
FUNC Func_MailboxEnterPulse
	testfor @a[MBst=1]
	SetblockTestfor
	
///	Just when entering
///	Testing if they have placed down the sign yet
///	MBst 0 - 1 - 2 = just entering
///	MBst 2 - 3 - 4 =inside 

///	MBsn 0 = get sign, MBsn 1 = don't get sign

	@a[$Entrance$,MBst=1] MBsn + 0
	@a[$Entrance$,MBst=1,MBsn=1] $FillEntrance$ stonebrick 0
	give @a[$Entrance$,MBst=1,MBsn=0] sign 1 0 {display:{Lore:["Place me on","the sea lantern"]},CanPlaceOn:["minecraft:sea_lantern"]}
	
///	Activates teleport disable
	@e[type=ArmorStand,MailboxStand] MBtp = 1
	
	@a[$Entrance$,MBst=1] setblock $ButtonGoIn$ air 0
	@a[$Entrance$,MBst=1] setblock $ButtonGoOut$ stone_button 1
	
	
	@a[$Entrance$,MBst=1,MBsn=0]
	@a[$Entrance$,MBst=1,MBsn=0]
	@a[$Entrance$,MBst=1,MBsn=0]
	@a[$Entrance$,MBst=1] MBst = 2
	
	@a[MBst=1] MBst = 0
END
//>

//<Mailbox Option Testfor Clock
	testfor @e[type=ArmorStand,MailboxStand,MBop>=1]
	SetblockTestfor
	
	
//>

//<Chest Calc Load 1
FUNC Func_ChestCalcLoad1
	summon ArmorStand $ArmorStandCoords$ {Tags:["MailboxCalc"],Invulnerable:1,PersistenceRequired:1,Invisible:1,Marker:1,NoGravity:1}
	@e[MailboxCalc] MBti = 1
	ScOP @e[MailboxCalc] MBid = @p MBid
	@e[MailboxCalc] MBid - 1
	
	//=
	@e[MailboxCalc,MBid>=0<=299] setblock $Load1$ redstone_block 0
	@e[MailboxCalc,MBid>=300<=599] setblock $Load2$ redstone_block 0
	@e[MailboxCalc,MBid>=600<=899] setblock $Load3$ redstone_block 0
	@e[MailboxCalc,MBid>=900<=1199] setblock $Load4$ redstone_block 0
	@e[MailboxCalc,MBid>=1200<=1400] setblock $Load5$ redstone_block 0
	@e[MailboxCalc,MBid>=1500<=1799] setblock $Load6$ redstone_block 0
	@e[MailboxCalc,MBid>=1800<=2099] setblock $Load7$ redstone_block 0
	fill $LoadAll$ stonebrick 0 replace redstone_block 0
	\\=
	
	LOOP 1 6 + 1
		$s$tp @e[MailboxCalc,MBid>=300] ~ ~ ~4
		@e[MailboxCalc,MBid>=300] MBid - 300
	END
	
	LOOP 1 30 + 1
		$s$tp @e[MailboxCalc,MBid>=10] ~ ~1 ~
		@e[MailboxCalc,MBid>=10] MBid - 10
	END
	
	LOOP 1 10 + 1
		$s$tp @e[MailboxCalc,MBid>=1] ~1 ~ ~
		@e[MailboxCalc,MBid>=1] MBid - 1
	END
END
//>

//<Chest Calc Load 2
FUNC Func_ChestCalcLoad2
	@e[MailboxCalc,MBti>=0] clone ~ ~ ~ ~ ~ ~1 $LoadChest$
	fill $FillAll$ stone 2 replace chest
	fill $FillAll$ stone 4 replace trapped_chest
	ScRS @e[MailboxCalc]
	$s$kill @e[MailboxCalc]
	Deactivate(CBPGeneralScoreboardClock)
END
//>

//<Chest Calc Save 1
FUNC Func_ChestCalcSave1
	summon ArmorStand $X$ $Y$ $Z$ {Tags:["MailboxCalc"],Invulnerable:1,PersistenceRequired:1,Invisible:1,Marker:1,NoGravity:1}
	@e[MailboxCalc] MBti = -1
	ScOP @e[MailboxCalc] MBid = @p MBid
	ScOP @e[MailboxCalc] MBis = @p MBid
	@e[MailboxCalc] MBid - 1
	
	@e[MailboxCalc,MBid>=0<=299] setblock $Load1$ redstone_block 0
	@e[MailboxCalc,MBid>=300<=599] setblock $Load2$ redstone_block 0
	@e[MailboxCalc,MBid>=600<=899] setblock $Load3$ redstone_block 0
	@e[MailboxCalc,MBid>=900<=1199] setblock $Load4$ redstone_block 0
	@e[MailboxCalc,MBid>=1200<=1400] setblock $Load5$ redstone_block 0
	@e[MailboxCalc,MBid>=1500<=1799] setblock $Load6$ redstone_block 0
	@e[MailboxCalc,MBid>=1800<=2099] setblock $Load7$ redstone_block 0
	fill $LoadAll$ stonebrick 0 replace redstone_block 0
	
	LOOP 1 6 + 1
		$s$tp @e[MailboxCalc,MBid>=300] ~ ~ ~4
		@e[MailboxCalc,MBid>=300] MBid - 300
	END
	
	LOOP 1 30 + 1
		$s$tp @e[MailboxCalc,MBid>=10] ~ ~1 ~
		@e[MailboxCalc,MBid>=10] MBid - 10
	END
	
	LOOP 1 10 + 1
		$s$tp @e[MailboxCalc,MBid>=1] ~1 ~ ~
		@e[MailboxCalc,MBid>=1] MBid - 1
	END
END
//>

//<Chest Calc Save 2
FUNC Func_ChestCalcSave2
	@e[MailboxCalc,MBti<=0] clone $SaveChest$ ~ ~ ~
	fill $SaveChest$ air 0
	@e[MailboxCalc,MBis>=0<=299] setblock $Save1$ redstone_block 0
	@e[MailboxCalc,MBis>=300<=599] setblock $Save2$ redstone_block 0
	@e[MailboxCalc,MBis>=600<=899] setblock $Save3$ redstone_block 0
	@e[MailboxCalc,MBis>=900<=1199] setblock $Save4$ redstone_block 0
	@e[MailboxCalc,MBis>=1200<=1400] setblock $Save5$ redstone_block 0
	@e[MailboxCalc,MBis>=1500<=1799] setblock $Save6$ redstone_block 0
	@e[MailboxCalc,MBis>=1800<=2099] setblock $Save7$ redstone_block 0
	fill $SaveAll$ stonebrick 0 replace redstone_block 0
END
//>

//<Chest Calc Save 3
FUNC Func_ChestCalcSave3
	fill $FillAll$ stone 2 replace chest
	fill $FillAll$ stone 4 replace trapped_chest
	ScRS @e[MailboxCalc]
	$s$kill @e[MailboxCalc]
	Deactivate(CBPGeneralScoreboardClock)
END
//>


//<General Scoreboard End
FUNC Func_GeneralScoreboardEnd
	USE $ObjR$
		MBid
		MBis
		MBst
		MBti
	UNUSE
	
END
//>



//<Groups
:CBPMainStart PULSE $Style$
Deactivate(CBPMainStart)
Func_GeneralScoreboardStart

:CBPGeneralScoreboardClock CLOCK $Style$
Func_GeneralScoreboardClock

:CBPMainEnd PULSE $Style$
Deactivate(CBPMainEnd)
Func_GeneralScoreboardEnd



:CBPChestCalcLoad1 PULSE $Style$
Deactivate(CBPChestCalcLoad1)
Func_ChestCalcLoad1
Activate(CBPGeneralScoreboardClock)

:CBPChestCalcLoad2 PULSE $Style$
Deactivate(CBPChestCalcLoad2)
Func_ChestCalcLoad2



:CBPChestCalcSave1 PULSE $Style$
Deactivate(CBPChestCalcSave1)
Func_ChestCalcSave1
Activate(CBPGeneralScoreboardClock)

:CBPChestCalcSave2 PULSE $Style$
Deactivate(CBPChestCalcSave2)
Func_ChestCalcSave2

:CBPChestCalcSave3 PULSE $Style$
Deactivate(CBPChestCalcSave3)
Func_ChestCalcSave3




//>



















