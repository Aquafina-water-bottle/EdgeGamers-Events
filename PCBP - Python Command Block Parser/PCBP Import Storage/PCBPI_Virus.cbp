
///	General virus import
///	PCBPI_Virus.cbp

//<General Scoreboard Start
FUNC Func_GeneralScoreboardStart
	USE $ObjA$
		V$VType$ dummy Virus $VType$
		VRpl dummy Virus $VType$ Player List
		VRpl2 dummy Virus $VType$ Player List 2
		VRde deathCount Virus $VType$ Deaths
		VRti dummy Virus $VType$ Timer
		VRti2 dummy Virus $VType$ Timer 2
		VRti3 dummy Virus $VType$ Timer 3
		VRxp dummy Virus $VType$ XP Calc
		VirusSave dummy Virus Save
		NumberObjAdd
	UNUSE
	ExecuteSpawnStand scoreboard objectives setdisplay sidebar V$VType$
	NumberAdd(60)
	NumberAdd(100)
	NumberAdd(600)
	
	USE $TeamA$
		VRh Virus $VType$ Hiders
		VRv Virus $VType$ Virus
		VRd_y V$VType$ Display Yellow
		VRd_g V$VType$ Display Green
	UNUSE
	
	USE $TeamO$
		VRv friendlyfire false
		VRv collisionRule never
///		VRv deathMessageVisibility false
		VRv color yellow
		
		VRh friendlyfire false
		VRh collisionRule never
///		VRv deathMessageVisibility false
		VRh color green
		VRh nametagVisibility hideForOtherTeams
		
		VRd_y color yellow
		VRd_g color green
	UNUSE
	ScTJ VRd_y Countdown Minutes Seconds Virus
	ScTJ VRd_g Hiders
	
	ExecuteSpawnStand summon ArmorStand ~ ~ ~ {Tags:["VRtimer"],Invulnerable:1,PersistenceRequired:1,Invisible:1,Marker:1,NoGravity:1}
	@e[type=ArmorStand,VRtimer] VRti + 0
	ExecuteSpawnStand @e[type=ArmorStand,VRtimer] VRti3 = -1
END
//>


//<Open Doors Pulse
FUNC Func_OpenDoorsPulse
	ScOP @e[type=ArmorStand,VRtimer] VRti2 = V$VType$Countdown VirusSave
	@e[type=ArmorStand,VRtimer] VRti3 = 0
	title @a title {"text":""}
	//(Change this to above hotbar in 1.11)
	title @a subtitle {"text":"The doors are now open","color":"green"}
	@a playsound minecraft:entity.player.levelup voice @a[c=1]
END
//>

//<Random Virus Select Pulse
FUNC Func_RandomVirusSelectPulse
	@r[$SP$,m=2,VRpl=1] VRpl = 2
END
//>

//<Tellraw Setting Pulse
FUNC Func_TellrawSettingPulse
	//-
	tellraw @a[EC=0] $TextStart$
	{"text":"Choose team: ","color":"gray"},
	{"text":"Hider","color":"green","italic":true,
		"hoverEvent":{"action":"show_text","value":{"text":"Force someone to join the hiders","color":"green"}},
		"clickEvent":{"action":"suggest_command","value":"/scoreboard players set PlayerName VRpl 1"}
	},
	{"text":", ","color":"gray","italic":true},
	{"text":"Virus","color":"yellow","italic":true,
		"hoverEvent":{"action":"show_text","value":{"text":"Force someone to join the virus","color":"yellow"}},
		"clickEvent":{"action":"suggest_command","value":"/scoreboard players set PlayerName VRpl 2"}
	}
	]}
	\\-
END
//>

//<Release Virus Testfor Clock
FUNC Func_ReleaseVirusTFClock
	testfor @e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=0]
	SetblockTestfor
	
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=0] ScRE Countdown V$VType$
	//(Change this to above hotbar in 1.11)
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=0] title @a title {"text":"The virus has","color":"yellow"}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=0] title @a subtitle {"text":"been released!","color":"yellow"}
		Func_EditReleaseVirusTFClock
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=0] VRti3 = 1
	ScOP @e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] VRti2 = V$VType$GameTime VirusSave
END
//>

//<End Game Testfor Clock
FUNC Func_EndGameTFClock
	testfor @e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1]
	SetblockTestfor
	
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] title @a title {"text":"Time!","color":"yellow"}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] tellraw @a $TextStart${"text":"The time is up! Hiders win!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] title @a subtitle {"text":"The hiders won!","color":"green"}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] ScRE Seconds V$VType$
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] ScRE Minutes V$VType$
		Func_EditReleaseVirusTFClock
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] VRti = -1
///	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=0,VRti3=1] VRti3 = 2
END
//>

//<Reset Settings Pulse
FUNC Func_ResetSettingsPulse
	V$VType$GameTime VirusSave = 600
	V$VType$Countdown VirusSave = 60
END
//>


//<General Scoreboard Clock
FUNC Func_GeneralScoreboardClock
/// baby i'm ballin
///	ArmorStand VRpl -- -1 = Before countdown, 0 = Doors open, 1 = Regular game, 2 = stop
///	Player VRpl -- 0 = Start, 1 = Hiding, 2 = Dead and will turn to the virus, 3 = Virus

///	General
	$s$kill @e[$SA$,type=Item]
		
///	Timer
	@e[type=ArmorStand,VRtimer,VRti>=0<=19,VRti2>=1,VRti3>=0] VRti + 1
	@e[type=ArmorStand,VRtimer,VRti=20,VRti2>=1,VRti3>=0] VRti2 - 1
	@e[type=ArmorStand,VRtimer,VRti=20,VRti2>=0,VRti3>=0] VRti = 0
	
///	Countdown stuff
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=30,VRti3=0] tellraw @a $TextStart${"text":"30 seconds until the virus is released!","color":"yellow"}]}
///	@e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1<=5,VRti3=0] tellraw @a $TextStart${"score":{"name":"@e[type=ArmorStand,VRtimer,VRti=0,VRti2>=5<=1,VRti3=0,c=1,r=1]","objective":"VRti2","color":"yellow"},{"text":"!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=5,VRti3=0] tellraw @a $TextStart${"text":"5!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=4,VRti3=0] tellraw @a $TextStart${"text":"4!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=3,VRti3=0] tellraw @a $TextStart${"text":"3!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=2,VRti3=0] tellraw @a $TextStart${"text":"2!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=1,VRti3=0] tellraw @a $TextStart${"text":"1!","color":"yellow"}]}
	
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=300,VRti3=1] tellraw @a $TextStart${"text":"5 minutes remain!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=300,VRti3=1] tellraw @a $TextStart${"text":"Glowing has been removed from all virus!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=300,VRti3=1] @a playsound entity.experience_orb.touch voice @a[c=1]
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=240,VRti3=1] tellraw @a $TextStart${"text":"4 minutes remain!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=180,VRti3=1] tellraw @a $TextStart${"text":"3 minutes remain!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=120,VRti3=1] tellraw @a $TextStart${"text":"2 minutes remain!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=60,VRti3=1] tellraw @a $TextStart${"text":"1 minute remain!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=30,VRti3=1] tellraw @a $TextStart${"text":"30 seconds remain!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=15,VRti3=1] tellraw @a $TextStart${"text":"15 seconds remain!","color":"yellow"}]}
///	@e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1<=5,VRti3=1] tellraw @a $TextStart${"score":{"name":"@e[type=ArmorStand,VRtimer,VRti=0,VRti2=15,VRti3=1,c=1,r=1]","objective":"VRti2","color":"yellow"}},{"text":"!","color":"yellow"}]} 
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=5,VRti3=1] tellraw @a $TextStart${"text":"5!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=4,VRti3=1] tellraw @a $TextStart${"text":"4!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=3,VRti3=1] tellraw @a $TextStart${"text":"3!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=2,VRti3=1] tellraw @a $TextStart${"text":"2!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2=1,VRti3=1] tellraw @a $TextStart${"text":"1!","color":"yellow"}]}
	
///	Display times
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1,VRti3>=0<=2,c=1] ScOP Seconds VRti = @e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1,VRti3>=0<=2,c=1] VRti2
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1,VRti3>=0<=2,c=1] ScOP Minutes VRti = @e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1,VRti3>=0<=2,c=1] VRti2
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1,VRti3>=0<=2,c=1] ScOP Seconds VRti %= 60 Number
	@e[type=ArmorStand,VRtimer,VRti=0,VRti2>=1,VRti3>=0<=2,c=1] ScOP Minutes VRti /= 60 Number
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti2>=1,VRti3=0] ScOP Countdown V$VType$ = Seconds VRti
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti2>=1,VRti3=1] ScOP Seconds V$VType$ = Seconds VRti
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti2>=1,VRti3=1] ScOP Minutes V$VType$ = Minutes VRti
	
///	General: Adds to hiders
	@e[type=ArmorStand,VRtimer,VRti>=0] $s$gamemode 2 @a[$SP$,m=0]
	@e[type=ArmorStand,VRtimer,VRti>=0] @a[$SP$,m=2] VRpl + 0
	@e[type=ArmorStand,VRtimer,VRti>=0] $s$clear @a[$SP$,m=2,VRpl=0]
	@e[type=ArmorStand,VRtimer,VRti>=0] @a[$SP$,m=2,VRpl=0,EC=0] SPbk = $SPid$
	@e[type=ArmorStand,VRtimer,VRti>=0] effect @a[$SP$,m=2,VRpl=0] clear
	@e[type=ArmorStand,VRtimer,VRti>=0] @a[$SP$,m=2,VRpl=0] VRpl = 1
	ScTJ VRh @a[$SA$,m=2,VRpl=1,team=!VRh]
	
///	Add to virus
	title @a[$SA$,m=2,VRpl=2] title {"text":"You are now","color":"yellow"}
	title @a[$SA$,m=2,VRpl=2] subtitle {"text":"the virus!","color":"yellow"}
	replaceitem entity @a[$SA$,m=2,VRpl=2] slot.armor.head golden_helmet 1 0 {Unbreakable:1}
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti3=1] $s$tp @a[$SP$,m=2,VRpl=2] $VirusEnd$
	@e[type=ArmorStand,VRtimer,VRti3>=-1<=0] $s$tp @a[$SP$,m=2,VRpl=2] $VirusBeg$
	@a[$SA$,m=2,VRpl=2] VRpl = 3
	ScTJ VRv @a[$SA$,m=2,VRpl=3,team=!VRv]
	
///	Effects
	@e[type=ArmorStand,VRtimer,VRti>=0] effect @a[$SA$,m=2,VRpl=3] 5 3 90 true
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti2>=302,VRti3=1] effect @a[$SA$,m=2,VRpl=3] 24 3 0 true
	@e[type=ArmorStand,VRtimer,VRti3=0] effect @a[$SA$,m=2,VRpl=3] 24 3 0 true
	effect @a[$SA$,m=2,VRpl>=1<=3] 11 3 3 true
	@e[type=ArmorStand,VRtimer,VRti=-1] effect @a[$SA$,m=2,VRpl=1] 11 3 9 true
	effect @a[$SA$,m=2,VRpl>=1<=3] 6 100 100 true
	
///	Player list (Hiders and Virus)
	@e[type=ArmorStand,VRtimer,VRti>=0] VRpl = 0
	@a[$SA$,m=2,VRpl=1] @e[type=ArmorStand,VRtimer,VRti>=0] VRpl + 1
	
	@e[type=ArmorStand,VRtimer,VRti>=0] VRpl2 = 0
	@a[$SA$,m=2,VRpl=3] @e[type=ArmorStand,VRtimer,VRti>=0] VRpl2 + 1
	
	ScOP Hiders V$VType$ = @e[type=ArmorStand,VRtimer,VRti>=0] VRpl
	ScOP Virus V$VType$ = @e[type=ArmorStand,VRtimer,VRti>=0] VRpl2
	
///	Detection if the virus won
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti3>=0,VRpl=0] title @a title {"text":"The virus won!","color":"yellow"}
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti3>=0,VRpl=0] tellraw @a $TextStart${"text":"The virus won!","color":"yellow"}]}
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti3>=0,VRpl=0] VRti = -1
	
///	XP
	$s$kill @e[$SA$,type=XPOrb]
	$s$xp -2147483648L @a[$SA$]
	ScOP @a[$SA$,m=2] VRxp = @e[type=ArmorStand,VRtimer,VRti>=0,VRti2>=0] VRti2
	ScOP @a[$SA$,m=2] VRxp *= 100 Number
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti2>=0,VRti3=0] ScOP @a[$SA$,m=2] VRxp /= 60 Number
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti2>=0,VRti3=1] ScOP @a[$SA$,m=2] VRxp /= 600 Number
	
	$s$xp 1129L @a[$SA$,VRxp>=0,m=2]
	$s$xp 11 @a[$SA$,VRxp>=0,m=2]
	LOOP 64 1 / 2 () 6336 99 / 2
		$s$xp |2| @a[$SA$,VRxp>=|0|,m=2]
		@a[$SA$,VRxp>=|0|,m=2] VRxp - |0|
	END
	$s$xp -1129L @a[$SA$,VRxp>=0,m=2]
	
	@a[$SA$,VRxp>=0] VRxp = 0
	
///	Deaths
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti3>=0<=1] @a[m=2,VRpl=1,VRde>=1] SPbk = $SPid$
	@e[type=ArmorStand,VRtimer,VRti>=0,VRti3>=0<=1] @a[m=2,VRpl=1,VRde>=1] VRpl = 2
	@a[VRde>=1] VRde = 0
END
//>

//<General Scoreboard End
FUNC Func_GeneralScoreboardEnd
	$s$clear @a[$SA$,m=2,VRpl>=0]
	@a[$SA$,EC=0] SPbk = $SPid$
	effect @a[$SA$,m=2,VRpl>=0] clear
	@a[$SA$,m=2,VRpl>=0] SPtp = $SPid$
	
	USE $ObjR$
		V$VType$
		VRpl
		VRpl2
		VRde
		VRti
		VRti2
		VRti3
		VRxp
	UNUSE
	
	USE $TeamR$
		VRh
		VRv
		VRd_y
		VRd_g
	UNUSE
	
	$s$kill @e[type=ArmorStand,VRtimer]
	
	fill $DoorMid$ redstone_block 0 replace stonebrick 0
	fill $DoorVirus$ redstone_block 0 replace stonebrick 0
END
//>


//<Groups
Func_CMDSave()

:CBPMainStart PULSE $Style$
Func_SpawnStandStart()
Deactivate(CBPMainStart)
Func_GeneralScoreboardStart()
Func_EditGeneralScoreboardStart()
Activate(CBPMainClock)
Activate(CBPReleaseVirusTFClock)
Activate(CBPEndGameTFClock)
FinalSpawnStand

:CBPMainClock CLOCK $Style$
Func_SpawnIDSetting()
Func_GeneralScoreboardClock()
Func_EditGeneralScoreboardClock()

:CBPMainEnd PULSE $Style$
Func_SpawnStandEnd()
Deactivate(CBPMainEnd)
Func_GeneralScoreboardEnd()
Func_EditGeneralScoreboardEnd()
Deactivate(CBPMainClock)
Deactivate(CBPReleaseVirusTFClock)
Deactivate(CBPEndGameTFClock)

:CBPOpenDoorsPulse PULSE $Style$
Deactivate(CBPOpenDoorsPulse)
Func_OpenDoorsPulse()
Func_EditOpenDoorsPulse()

:CBPReleaseVirusTFClock CLOCK $Style$
Func_ReleaseVirusTFClock()

:CBPEndGameTFClock CLOCK $Style$
Func_EndGameTFClock()

:CBPTellrawSettingPulse PULSE $Style$
Deactivate(CBPTellrawSettingPulse)
Func_TellrawSettingPulse()

:CBPResetSettingsPulse PULSE $Style$
Deactivate(CBPResetSettingsPulse)
Func_ResetSettingsPulse()

:CBPRandomVirusSelectPulse PULSE $Style$
Deactivate(CBPRandomVirusSelectPulse)
Func_RandomVirusSelectPulse()
//>





















