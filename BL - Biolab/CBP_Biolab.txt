//#-p coal_block -print
// Minecraft Planetside 2 Biolab Engine
// Made by Icohedron.

//// Notes ////
// Notification format: ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": "]

// The following commands need to have the "minecraft:" prefix to them
// /xp
// /kill
// /tp
// /give
// /clear

//// Global Definitions ////
DEFINE deactivate fill |0| coal_block redstone_block
DEFINE activate fill |0| redstone_block coal_block

//// Player ID (PID) System ////
FUNC enablePID
	scoreboard objectives add BiolabPID dummy Player ID
	activate(PIDUpdate)
END

:PIDUpdate CLOCK 16 0 1
scoreboard players add @a BiolabPID 0
@a[BiolabPID=0,c=1] scoreboard players add HighestValueIdentifier BiolabPID 1
scoreboard players operation @a[BiolabPID=0,c=1] BiolabPID = HighestValueIdentifier BiolabPID
scoreboard players tag @a[BiolabPlayer] remove BiolabPlayer
scoreboard players tag @a[x=-3,y=150,z=-1085,dx=-202,dy=-150,dz=-210] add BiolabPlayer

FUNC disablePID
	deactivate(PIDUpdate)
	scoreboard objectives remove BiolabPID
	scoreboard players tag * remove BiolabPlayer
END

//// Teams ////
FUNC setTeams
	LOOP (Blue;Red;Purple)
		scoreboard teams add Biolab|0|
		scoreboard teams option Biolab|0| nametagVisibility hideForOtherTeams
	END
	
	LOOP (Blue;Red;Purple;Neutral)
		scoreboard teams add BiolabCP|0|
		scoreboard teams option BiolabCP|0| nametagVisibility always
	END
	
	scoreboard teams option BiolabBlue color blue
	scoreboard teams option BiolabRed color red
	scoreboard teams option BiolabPurple color light_purple
	
	scoreboard teams option BiolabBlue friendlyfire false
	scoreboard teams option BiolabRed friendlyfire false
	scoreboard teams option BiolabPurple friendlyfire false
	
	scoreboard teams option BiolabCPBlue color blue
	scoreboard teams option BiolabCPRed color red
	scoreboard teams option BiolabCPPurple color light_purple
	scoreboard teams option BiolabCPNeutral color white
END

FUNC removeTeams
	scoreboard teams remove BiolabBlue
	scoreboard teams remove BiolabRed
	scoreboard teams remove BiolabPurple
END

//// Team Functions ////
FUNC initializeTeamPlayerCounter
	scoreboard objectives add BiolabTPC dummy Team Player Counts
	summon ArmorStand ~ ~ ~ {Tags:["BiolabTeamPlayerCounter","BiolabTeamBluePlayers"],NoGravity:1b,Marker:1b,Invisible:1b}
	summon ArmorStand ~ ~ ~ {Tags:["BiolabTeamPlayerCounter","BiolabTeamRedPlayers"],NoGravity:1b,Marker:1b,Invisible:1b}
	summon ArmorStand ~ ~ ~ {Tags:["BiolabTeamPlayerCounter","BiolabTeamPurplePlayers"],NoGravity:1b,Marker:1b,Invisible:1b}
END

FUNC updateTeamPlayerCounter
	@e[BiolabTeamPlayerCounter] BiolabTPC = 0
	@a[team=BiolabBlue,m=2] @e[BiolabTeamBluePlayers] BiolabTPC + 1
	@a[team=BiolabRed,m=2] @e[BiolabTeamRedPlayers] BiolabTPC + 1
	@a[team=BiolabPurple,m=2] @e[BiolabTeamPurplePlayers] BiolabTPC + 1
END

:balanceTeams PULSE 16 0 1
updateTeamPlayerCounter
BiolabTeamComparator BiolabTPC = @e[BiolabTeamBluePlayers] BiolabTPC
BiolabTeamComparator BiolabTPC - @e[BiolabTeamRedPlayers] BiolabTPC
scoreboard players test BiolabTeamComparator BiolabTPC 2
CONDITION
	scoreboard players tag @r[team=BiolabBlue,m=2] add MovRed
scoreboard players test BiolabTeamComparator BiolabTPC -100 -2
CONDITION
	scoreboard players tag @r[team=BiolabRed,m=2] add MovBlue

BiolabTeamComparator BiolabTPC = @e[BiolabTeamBluePlayers] BiolabTPC
BiolabTeamComparator BiolabTPC - @e[BiolabTeamPurplePlayers] BiolabTPC
scoreboard players test BiolabTeamComparator BiolabTPC 2
CONDITION
	scoreboard players tag @r[team=BiolabBlue,m=2] add MovPurple
scoreboard players test BiolabTeamComparator BiolabTPC -100 -2
CONDITION
	scoreboard players tag @r[team=BiolabPurple,m=2] add MovBlue

BiolabTeamComparator BiolabTPC = @e[BiolabTeamRedPlayers] BiolabTPC
BiolabTeamComparator BiolabTPC - @e[BiolabTeamPurplePlayers] BiolabTPC
scoreboard players test BiolabTeamComparator BiolabTPC 2
CONDITION
	scoreboard players tag @r[team=BiolabRed,m=2] add MovPurple
scoreboard players test BiolabTeamComparator BiolabTPC -100 -2
CONDITION
	scoreboard players tag @r[team=BiolabPurple,m=2] add MovRed

scoreboard teams leave @a[MovBlue]
testfor @a[MovBlue]
CONDITION
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[tag=MovBlue]"}," has been moved to ",{"text":"Blue","color":"blue"}," to balance teams."]
effect @a[MovBlue] clear
clear @a[MovBlue]
scoreboard teams join BiolabBlue @a[MovBlue]
tp @a[MovBlue] -120.0 19 -1193 0 0
scoreboard players tag @a[MovBlue] remove InLift
scoreboard players tag @a[MovBlue] remove MovBlue

scoreboard teams leave @a[MovRed]
testfor @a[MovRed]
CONDITION
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[tag=MovRed]"}," has been moved to ",{"text":"Red","color":"red"}," to balance teams."]
effect @a[MovRed] clear
clear @a[MovRed]
scoreboard teams join BiolabRed @a[MovRed]
tp @a[MovRed] -133 19 -1205.0 90 0
scoreboard players tag @a[MovRed] remove InLift
scoreboard players tag @a[MovRed] remove MovRed

scoreboard teams leave @a[MovPurple]
testfor @a[MovPurple]
CONDITION
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[tag=MovPurple]"}," has been moved to ",{"text":"Purple","color":"light_purple"}," to balance teams."]
effect @a[MovPurple] clear
clear @a[MovPurple]
scoreboard teams join BiolabPurple @a[MovPurple]
tp @a[MovPurple] -108 19 -1205.0 -90 0
scoreboard players tag @a[MovPurple] remove InLift
scoreboard players tag @a[MovPurple] remove MovPurple
deactivate(balanceTeams)

FUNC deinitializeTeamPlayerCounter
	kill @e[BiolabTeamPlayerCounter]
	scoreboard objectives remove BiolabTPC
END

:countPlayers PULSE 16 0 1
updateTeamPlayerCounter
tellraw @p ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Player Count"]
tellraw @p ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"text":"Blue","color":"blue"}," Team: ",{"score":{"name":"@e[tag=BiolabTeamBluePlayers]","objective":"BiolabTPC"}}]
tellraw @p ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"text":"Red","color":"red"}," Team: ",{"score":{"name":"@e[tag=BiolabTeamRedPlayers]","objective":"BiolabTPC"}}]
tellraw @p ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"text":"Purple","color":"light_purple"}," Team: ",{"score":{"name":"@e[tag=BiolabTeamPurplePlayers]","objective":"BiolabTPC"}}]
deactivate(countPlayers)

//// Team Joining ////
:teamJoining CLOCK  16 0 1
// Neutral Area //
gamemode 2 @a[BiolabPlayer,m=0]

scoreboard players tag @a[x=-114,y=19,z=-1212,dx=-13,dy=6,dz=13] add InBiolabSpawn
tp @a[InBiolabSpawn,team=BiolabBlue,m=2] -120.0 19 -1193 0 0
tp @a[InBiolabSpawn,team=BiolabRed,m=2] -133 19 -1205.0 90 0
tp @a[InBiolabSpawn,team=BiolabPurple,m=2] -108 19 -1205.0 -90 0

// Reset Experience
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabCPL
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabDPL
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabLD
// Reset Sneak Timer (Light Assault and Infiltrator)
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabSneakTimer
// Reset Carrot On A Stick Statistics (Combat Medic, Infiltrator, and Heavy Assault)
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabCOS
// Reset Light Assault
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabJC
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabJCP
scoreboard players tag @a[InBiolabSpawn,m=2] remove LightAssault
scoreboard players tag @a[InBiolabSpawn,m=2] remove JetpackEnabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove JetpackDisabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove JetpackCooldown
// Reset Infiltrator
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabCC
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabLI
scoreboard players tag @a[InBiolabSpawn,m=2] remove Infiltrator
scoreboard players tag @a[InBiolabSpawn,m=2] remove CloakEnabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove CloakDisabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove CloakCooldown
// Reset Combat Medic
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabNRC
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabNRCP
scoreboard players tag @a[InBiolabSpawn,m=2] remove CombatMedic
scoreboard players tag @a[InBiolabSpawn,m=2] remove NanoRegenEnabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove NanoRegenDisabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove NanoRegenCooldown
// Reset Engineer
scoreboard players tag @a[InBiolabSpawn,m=2] remove Engineer
scoreboard players operation @e[AmmoPack] BiolabAPO -= @a[InBiolabSpawn,m=2] BiolabPID
kill @e[AmmoPack,BiolabAPO=0]
scoreboard players operation @e[AmmoPack] BiolabAPO += @a[InBiolabSpawn,m=2] BiolabPID
// Reset Heavy Assault
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabNSC
scoreboard players reset @a[InBiolabSpawn,m=2] BiolabNSCP
scoreboard players tag @a[InBiolabSpawn,m=2] remove HeavyAssault
scoreboard players tag @a[InBiolabSpawn,m=2] remove NaniteShieldEnabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove NaniteShieldDisabled
scoreboard players tag @a[InBiolabSpawn,m=2] remove NaniteShieldCooldown
// Reset MAX
scoreboard players tag @a[InBiolabSpawn,m=2] remove MAX
// Finishing touches
effect @a[InBiolabSpawn,m=2] clear
clear @a[InBiolabSpawn,m=2]
xp -1000000L @a[InBiolabSpawn,m=2]
scoreboard players tag @a[InBiolabSpawn] remove InBiolabSpawn

// Blue team join
particle magicCrit -120.0 21 -1198 2.5 2 0 0 30
testfor @a[x=-117,y=19,z=-1198,dx=-7,dy=4,m=2]
CONSTART
	tellraw @a ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[x=-117,y=19,z=-1198,dx=-7,dy=4,m=2]"}," has joined team ",{"text":"Blue","color":"blue"},"!"]
	scoreboard teams join BiolabBlue @a[x=-117,y=19,z=-1198,dx=-7,dy=4,m=2]
	tp @a[x=-117,y=19,z=-1198,dx=-7,dy=4,m=2] -120.0 19 -1193 0 0
CONEND
// Blue team leave
particle magicCrit -120.0 21 -1196 2.5 2 0 0 30
clear @a[x=-117,y=19,z=-1196,dx=-7,dy=4,m=2]
scoreboard teams leave @a[x=-117,y=19,z=-1196,dx=-7,dy=4,m=2]
CONSTART
	tellraw @a ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[x=-117,y=19,z=-1196,dx=-7,dy=4,m=2]"}," has left team ",{"text":"Blue","color":"blue"},"!"]
	tp @a[x=-117,y=19,z=-1196,dx=-7,dy=4,m=2] -120.0 19 -1200 180 0
CONEND

// Red team join
particle reddust -128 21 -1205.0 0 2 2.5 0 20
testfor @a[x=-128,y=19,z=-1202,dy=4,dz=-7,m=2]
CONSTART
	tellraw @a ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[x=-128,y=19,z=-1202,dy=4,dz=-7,m=2]"}," has joined team ",{"text":"Red","color":"red"},"!"]
	scoreboard teams join BiolabRed @a[x=-128,y=19,z=-1202,dy=4,dz=-7,m=2]
	tp @a[x=-128,y=19,z=-1202,dy=4,dz=-7,m=2] -133 19 -1205.0 90 0
CONEND
// Red team leave
particle reddust -130 21 -1205.0 0 2 2.5 0 20
clear @a[x=-130,y=19,z=-1202,dy=4,dz=-7,m=2]
scoreboard teams leave @a[x=-130,y=19,z=-1202,dy=4,dz=-7,m=2]
CONSTART
	tellraw @a ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[x=-130,y=19,z=-1202,dy=4,dz=-7,m=2]"}," has left team ",{"text":"Red","color":"red"},"!"]
	tp @a[x=-130,y=19,z=-1202,dy=4,dz=-7,m=2] -126 19 -1205.0 -90 0
CONEND

// Purple team join
particle dragonbreath -113 21 -1205.0 0 2 2.5 0 6
testfor @a[x=-113,y=19,z=-1209,dy=4,dz=7,m=2]
CONSTART
	tellraw @a ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[x=-113,y=19,z=-1209,dy=4,dz=7,m=2]"}," has joined team ",{"text":"Purple","color":"light_purple"},"!"]
	scoreboard teams join BiolabPurple @a[x=-113,y=19,z=-1209,dy=4,dz=7,m=2]
	tp @a[x=-113,y=19,z=-1209,dy=4,dz=7,m=2] -108 19 -1205.0 -90 0
CONEND
// Purple team leave
particle dragonbreath -111 21 -1205.0 0 2 2.5 0 6
clear @a[x=-111,y=19,z=-1209,dy=4,dz=7,m=2]
scoreboard teams leave @a[x=-111,y=19,z=-1209,dy=4,dz=7,m=2]
CONSTART
	tellraw @a ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@a[x=-111,y=19,z=-1209,dy=4,dz=7,m=2]"}," has left team ",{"text":"Purple","color":"light_purple"},"!"]
	tp @a[x=-111,y=19,z=-1209,dy=4,dz=7,m=2] -115 19 -1205.0 90 0
CONEND

//// Experience Bar Indicator ////
FUNC enableExperienceIndicator
	scoreboard objectives add BiolabCPL dummy Current Player Level
	scoreboard objectives add BiolabDPL dummy Desired Player Level
	scoreboard objectives add BiolabLD dummy Level Difference
	activate(updateExperienceIndicator)
END

:updateExperienceIndicator CLOCK 16 0 1
@a[BiolabPlayer] BiolabCPL + 0
@a[BiolabPlayer] BiolabLD + 0

stats entity @a set QueryResult @p BiolabCPL
@a[BiolabPlayer] xp 0L @p

@a[BiolabPlayer] BiolabLD = BiolabCPL
@a[BiolabPlayer] BiolabLD - BiolabDPL

xp -1L @a[BiolabLD>0]
xp 1L @a[BiolabLD<0]

FUNC disableExperienceIndicator
	deactivate(updateExperienceIndicator)
	scoreboard objectives remove BiolabCPL
	scoreboard objectives remove BiolabDPL
	scoreboard objectives remove BiolabLD
END

// Weapon Options
DEFINE snowballSpottingRange 2
DEFINE snowballDamage 0
DEFINE snowballDelay 2
DEFINE reloadTime 30

//// Weapons ////
FUNC enableWeapons
	scoreboard objectives add BiolabUS stat.useItem.minecraft.snowball Use Snowball
	scoreboard objectives add BiolabRT dummy Reload Timer
	activate(weapons)
END

:weapons CLOCK 16 0 1
// Clear all dropped items except Ammo Packs
scoreboard players tag @e[type=Item] add AmmoPack {Item:{id:"minecraft:stone_slab"}}
kill @e[x=-3,y=150,z=-1085,dx=-202,dy=-150,dz=-210,type=Item,!AmmoPack]

// Snowball damage and effects
@p[BiolabUS>0,team=BiolabBlue] scoreboard players tag @e[type=Snowball,c=1] add BlueSnowball
@p[BiolabUS>0,team=BiolabRed] scoreboard players tag @e[type=Snowball,c=1] add RedSnowball
@p[BiolabUS>0,team=BiolabPurple] scoreboard players tag @e[type=Snowball,c=1] add PurpleSnowball
scoreboard players set @a[BiolabUS>0] BiolabUS 0

@e[BlueSnowball] @a[r=snowballSpottingRange,team=!BiolabBlue] effect @p[r=0] minecraft:glowing 5 0
@e[RedSnowball] @a[r=snowballSpottingRange,team=!BiolabRed] effect @p[r=0] minecraft:glowing 5 0
@e[PurpleSnowball] @a[r=snowballSpottingRange,team=!BiolabPurple] effect @p[r=0] minecraft:glowing 5 0

@e[BlueSnowball] particle reddust ~ ~ ~ -1 0 1 -0.05
@e[RedSnowball] particle reddust ~ ~ ~ 0 0 0 -0.05
@e[PurpleSnowball] particle reddust ~ ~ ~ 0 0 1 -0.05

@e[BlueSnowball] @a[r=2,team=!BiolabBlue] effect @p[r=0] minecraft:instant_damage 1 snowballDamage
@e[RedSnowball] @a[r=2,team=!BiolabRed] effect @p[r=0] minecraft:instant_damage 1 snowballDamage
@e[PurpleSnowball] @a[r=2,team=!BiolabPurple] effect @p[r=0] minecraft:instant_damage 1 snowballDamage

// Ammo and Reloading System
scoreboard players tag @a remove HasMagazine
scoreboard players tag @a add HasMagazine {Inventory:[{id:"minecraft:prismarine_shard",tag:{display:{Name:"Magazine"}}}]}

scoreboard players tag @a remove HasSnowballs
scoreboard players tag @a add HasSnowballs {Inventory:[{id:"minecraft:snowball",tag:{display:{Name:"Bullets"}}}]}

scoreboard players add @a BiolabRT 0
@a[!HasSnowballs] scoreboard players set @p[HasMagazine,BiolabRT=0,r=0] BiolabRT 1
scoreboard players add @a[BiolabRT>0] BiolabRT 1
clear @a[BiolabRT>=reloadTime] minecraft:prismarine_shard 0 1 {display:{Name:"Magazine"}}
replaceitem entity @a[BiolabRT>=reloadTime] slot.hotbar.1 minecraft:snowball 16 0 {display:{Name:"Bullets"}}
@a[BiolabRT>=reloadTime] scoreboard players set @p[r=0] BiolabRT 0

FUNC disableWeapons
	deactivate(weapons)
	scoreboard objectives remove BiolabUS
	scoreboard objectives remove BiolabRT
	scoreboard players tag * remove HasMagazine
	scoreboard players tag * remove HasSnowballs
END

//// Teleporters (Two-Way) ////
FUNC addTeleporter
	summon ArmorStand |1| |2| |3| {CustomName:"|0|",CustomNameVisible:1b,Tags:["BiolabTeleporter","|0|1","|9|"],Marker:1b,Invulnerable:1b:,NoGravity:1b,Invisible:1b,PersistenceRequired:1b,Rotation:[|4|,0.0f,0.0f]}
	summon ArmorStand |5| |6| |7| {CustomName:"|0|",CustomNameVisible:1b,Tags:["BiolabTeleporter","|0|2","|9|"],Marker:1b,Invulnerable:1b:,NoGravity:1b,Invisible:1b,PersistenceRequired:1b,Rotation:[|8|,0.0f,0.0f]}
END

FUNC enableTeleporters
	addTeleporter(Blue_Outside;-116;20;-1193;90.0f;-87;44;-1276;180.0f;BiolabBlue)
	addTeleporter(Blue_Teleporter_1;-128;20;-1195;-54.0f;-82;67;-1221;-45.0f;BiolabBlue)
	addTeleporter(Blue_Teleporter_2;-128;20;-1191;-118.0f;-109;67;-1237;36.0f;BiolabBlue)
	
	addTeleporter(Red_Control_Room;-133;20;-1201;180.0f;-100;44;-1187;135.0f;BiolabRed)
	addTeleporter(Red_Teleporter_1;-109;44;-1187;-135.0f;-151;67;-1197;-15.0f;BiolabRed)
	addTeleporter(Red_Teleporter_2;-100;44;-1196;45.0f;-110;67;-1187;45.0f;BiolabRed)
	
	addTeleporter(Purple_Outside;-108;20;-1210;0.0f;-101;44;-1105;0.0f;BiolabPurple)
	addTeleporter(Purple_Teleporter_1;-108;20;-1201;180.0f;-80;67;-1161;-36.0f;BiolabPurple)
	
	addTeleporter(Control_Point_D;-203;45;-1099;-90.0f;-200;44;-1158;180.0f;BiolabNeutral)
	
	activate(teleporters)
END

FUNC updateTeamTeleporter
	@e[|0|1] scoreboard players tag @a[!InTeleporter,r=1,team=|1|] add Teleporting
	@e[|0|1] tp @a[!InTeleporter,r=1,team=|1|] @e[|0|2]
	@e[|0|2] scoreboard players tag @a[Teleporting] add InTeleporter
	
	@e[|0|2] scoreboard players tag @a[!InTeleporter,r=1,team=|1|] add Teleporting
	@e[|0|2] tp @a[!InTeleporter,r=1,team=|1|] @e[|0|1]
	@e[|0|1] scoreboard players tag @a[Teleporting] add InTeleporter
END

FUNC updateTeleporter
	@e[|0|1] scoreboard players tag @a[!InTeleporter,r=1] add Teleporting
	@e[|0|1] tp @a[!InTeleporter,r=1] @e[|0|2]
	@e[|0|2] scoreboard players tag @a[Teleporting] add InTeleporter
	
	@e[|0|2] scoreboard players tag @a[!InTeleporter,r=1] add Teleporting
	@e[|0|2] tp @a[!InTeleporter,r=1] @e[|0|1]
	@e[|0|1] scoreboard players tag @a[Teleporting] add InTeleporter
END

:teleporters CLOCK 16 0 1
updateTeamTeleporter(Blue_Outside;BiolabBlue)
updateTeamTeleporter(Blue_Teleporter_1;BiolabBlue)
updateTeamTeleporter(Blue_Teleporter_2;BiolabBlue)

updateTeamTeleporter(Red_Control_Room;BiolabRed)
updateTeamTeleporter(Red_Teleporter_1;BiolabRed)
updateTeamTeleporter(Red_Teleporter_2;BiolabRed)

updateTeamTeleporter(Purple_Outside;BiolabPurple)
updateTeamTeleporter(Purple_Teleporter_1;BiolabPurple)

updateTeleporter(Control_Point_D)

@a[Teleporting] @e[BiolabTeleporter,c=1] playsound minecraft:entity.endermen.teleport voice @a ~ ~ ~
@a[Teleporting] @e[BiolabTeleporter,c=1] scoreboard players tag @a[Teleporting] remove Teleporting

@e[BiolabTeleporter] @e[BiolabBlue,r=1,c=1] particle reddust ~ ~1 ~ -1 0 1 -0.05
@e[BiolabTeleporter] @e[BiolabRed,r=1,c=1] particle reddust ~ ~1 ~ 0 0 0 -0.05
@e[BiolabTeleporter] @e[BiolabPurple,r=1,c=1] particle reddust ~ ~1 ~ 0 0 1 -0.05
@e[BiolabTeleporter] @e[BiolabNeutral,r=1,c=1] particle reddust ~ ~1 ~ 0 1 1 -0.05

@e[BiolabTeleporter] scoreboard players tag @a[r=2,rm=1] remove InTeleporter

FUNC disableTeleporters
	deactivate(teleporters)
	kill @e[BiolabTeleporter]
	scoreboard players tag * remove InTeleporter
	scoreboard players tag * remove Teleporting
END

// Force Field Options
DEFINE backtrackDistance 0.3

//// Force Fields and Spawn Protection ////
:forceFields CLOCK 16 0 1
// Red Team
particle reddust -104.0 46 -1186 2.5 3 0 0 50 None @a Force
tp @a[x=-108,y=42,z=-1186,dx=7,dy=7,team=!BiolabRed,m=2] ~ ~ ~backtrackDistance
particle reddust -104.0 46 -1197 2.5 3 0 0 50 None @a Force
tp @a[x=-101,y=42,z=-1197,dx=-7,dy=7,team=!BiolabRed,m=2]  ~ ~ ~-backtrackDistance
particle reddust -99 46 -1191.0 0 3 2.5 0 50 None @a Force
tp @a[x=-99,y=42,z=-1188,dy=7,dz=-7,team=!BiolabRed,m=2] ~backtrackDistance ~ ~
particle reddust -110 46 -1191.0 0 3 2.5 0 50 None @a Force
tp @a[x=-110,y=42,z=-1195,dy=7,dz=7,team=!BiolabRed,m=2] ~-backtrackDistance ~ ~
effect @e[x=-109,y=50,z=-1187,dx=9,dy=-8,dz=-9,team=BiolabRed] minecraft:resistance 1 5 true

particle reddust -147 67 -1191 0 0.75 0.75 0 8 None @a Force
tp @a[x=-147,y=66,z=-1190,dy=2,dz=-2,team=!BiolabRed,m=2] ~backtrackDistance ~ ~
particle reddust -152 67 -1190 0 0.75 0.75 0 8 None @a Force
tp @a[x=-152,y=66,z=-1191,dy=2,dz=2,team=!BiolabRed,m=2] ~-backtrackDistance ~ ~
particle reddust -149.0 67 -1184 1 0.75 0 0 9 None @a Force
tp @a[x=-151,y=66,z=-1184,dx=3,dy=2,team=!BiolabRed,m=2] ~ ~ ~backtrackDistance
effect @e[x=-148,y=70,z=-1197,dx=-3,dy=-4,dz=12,team=BiolabRed] minecraft:resistance 1 5 true

// Blue Team
particle magicCrit -90 44 -1278 0 0.75 0.75 0 8 None @a Force
tp @a[x=-90,y=43,z=-1279,dy=2,dz=2,team=!BiolabBlue,m=2] ~-backtrackDistance ~ ~
particle magicCrit -88 44 -1280 0.75 0.75 0 0 8 None @a Force
tp @a[x=-87,y=43,z=-1280,dx=-2,dy=2,team=!BiolabBlue,m=2] ~ ~ ~-backtrackDistance
particle magicCrit -83 44 -1278 0 0.75 0.75 0 8 None @a Force
tp @a[x=-83,y=43,z=-1277,dy=2,dz=-2,team=!BiolabBlue,m=2] ~backtrackDistance ~ ~
effect @e[x=-84,y=43,z=-1276,dx=-5,dy=3,dz=-3,team=BiolabBlue] minecraft:resistance 1 5 true

particle magicCrit -113 67 -1235 0 0.75 0.75 0 8 None @a Force
tp @a[x=-113,y=66,z=-1236,dy=2,dz=2,team=!BiolabBlue,m=2] ~-backtrackDistance ~ ~
particle magicCrit -110 67 -1231 0.75 0.75 0 0 8 None @a Force
tp @a[x=-111,y=66,z=-1231,dx=2,dy=2,team=!BiolabBlue,m=2] ~ ~ ~backtrackDistance
effect @e[x=-112,y=66,z=-1232,dx=3,dy=4,dz=-5,team=BiolabBlue] minecraft:resistance 1 5 true

particle magicCrit -81 67 -1215 0.75 0.75 0 0 8 None @a Force
tp @a[x=-76,y=66,z=-1219,dy=2,dz=-2,team=!BiolabBlue,m=2] ~backtrackDistance ~ ~
particle magicCrit -76 67 -1220 0 0.75 0.75 0 8 None @a Force
tp @a[x=-82,y=66,z=-1215,dx=2,dy=2,team=!BiolabBlue,m=2] ~ ~ ~backtrackDistance
effect @e[x=-77,y=66,z=-1216,dx=-5,dy=4,dz=-5,team=BiolabBlue] minecraft:resistance 1 5 true

// Purple Team
particle dragonbreath -98 44 -1103 0 0.75 0.75 0 4 None @a Force
tp @a[x=-98,y=43,z=-1102,dy=2,dz=-2,team=!BiolabPurple,m=2] ~backtrackDistance ~ ~
particle dragonbreath -100 44 -1101 0.75 0.75 0 0 4 None @a Force
tp @a[x=-101,y=43,z=-1101,dx=2,dy=2,team=!BiolabPurple,m=2] ~ ~ ~backtrackDistance
particle dragonbreath -105 44 -1103 0 0.75 0.75 0 4 None @a Force
tp @a[x=-105,y=43,z=-1104,dy=2,dz=2,team=!BiolabPurple,m=2] ~-backtrackDistance ~ ~
effect @e[x=-104,y=46,z=-1102,dx=5,dy=-3,dz=-3,team=BiolabPurple] minecraft:resistance 1 5 true

particle dragonbreath -77 67 -1155 0.75 0.75 0 0 4 None @a Force
tp @a[x=-78,y=66,z=-1155,dx=2,dy=2,team=!BiolabPurple,m=2] ~ ~ ~backtrackDistance
particle dragonbreath -75 67 -1159 0 0.75 0.75 0 4 None @a Force
tp @a[x=-75,y=66,z=-1158,dy=2,dz=-2,team=!BiolabPurple,m=2] ~backtrackDistance ~ ~
effect @e[x=-76,y=66,z=-1156,dx=-4,dy=3,dz=-5,team=BiolabPurple] minecraft:resistance 1 5 true

// Lift Options
DEFINE liftHeight 22
DEFINE liftMaxClearHeight 72

//// Biolab Lift Controls /////
:southLift CLOCK 16 0 1
effect @a[x=-101,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-102,y=45,z=-1127,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-102,y=45,z=-1125,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-103,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-104,y=45,z=-1125,dx=-1,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-104,y=45,z=-1127,dx=-1,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-106,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-107,y=45,z=-1125,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-107,y=45,z=-1127,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-108,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-102,y=45,z=-1126,dy=liftHeight] minecraft:levitation 1 245 true
effect @a[x=-107,y=45,z=-1126,dy=liftHeight] minecraft:levitation 1 245 true
effect @a[x=-104,y=45,z=-1126,dx=-1,dy=liftHeight] minecraft:levitation 1 6 true
effect @a[x=-102,y=45,z=-1126,dy=liftHeight] minecraft:jump_boost 2 255 true
effect @a[x=-107,y=45,z=-1126,dy=liftHeight] minecraft:jump_boost 2 255 true
effect @a[x=-104,y=45,z=-1126,dx=-1,dy=liftHeight] minecraft:jump_boost 2 255 true

scoreboard players tag @a[x=-101,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] remove InLift
scoreboard players tag @a[x=-102,y=45,z=-1127,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-102,y=45,z=-1125,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-103,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] remove InLift
scoreboard players tag @a[x=-104,y=45,z=-1125,dx=-1,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-104,y=45,z=-1127,dx=-1,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-106,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] remove InLift
scoreboard players tag @a[x=-107,y=45,z=-1125,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-107,y=45,z=-1127,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-108,y=45,z=-1125,dy=liftMaxClearHeight,dz=-2] remove InLift

scoreboard players tag @a[x=-102,y=45,z=-1126,dy=liftHeight] add InLift
scoreboard players tag @a[x=-107,y=45,z=-1126,dy=liftHeight] add InLift
scoreboard players tag @a[x=-104,y=45,z=-1126,dx=-1,dy=liftHeight] add InLift
scoreboard players tag @a[x=-102,y=45,z=-1126,dy=liftHeight] add InLift
scoreboard players tag @a[x=-107,y=45,z=-1126,dy=liftHeight] add InLift
scoreboard players tag @a[x=-104,y=45,z=-1126,dx=-1,dy=liftHeight] add InLift

particle reddust -102 45 -1126 0.25 8 0.25 0 5 None @a Force
particle reddust -107 45 -1126 0.25 8 0.25 0 5 None @a Force
particle magicCrit -104 45 -1126 0.25 8 0.25 0 10 None @a Force
particle magicCrit -105 45 -1126 0.25 8 0.25 0 10 None @a Force

:northLift CLOCK 16 0 1
effect @a[x=-101,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-102,y=45,z=-1258,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-102,y=45,z=-1256,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-103,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-104,y=45,z=-1256,dx=-1,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-104,y=45,z=-1258,dx=-1,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-106,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-107,y=45,z=-1256,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-107,y=45,z=-1258,dy=liftMaxClearHeight] minecraft:levitation 0
effect @a[x=-108,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] minecraft:levitation 0
effect @a[x=-102,y=45,z=-1257,dy=liftHeight] minecraft:levitation 1 245 true
effect @a[x=-107,y=45,z=-1257,dy=liftHeight] minecraft:levitation 1 245 true
effect @a[x=-104,y=45,z=-1257,dx=-1,dy=liftHeight] minecraft:levitation 1 6 true
effect @a[x=-102,y=45,z=-1257,dy=liftHeight] minecraft:jump_boost 2 255 true
effect @a[x=-107,y=45,z=-1257,dy=liftHeight] minecraft:jump_boost 2 255 true
effect @a[x=-104,y=45,z=-1257,dx=-1,dy=liftHeight] minecraft:jump_boost 2 255 true

scoreboard players tag @a[x=-101,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] remove InLift
scoreboard players tag @a[x=-102,y=45,z=-1258,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-102,y=45,z=-1256,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-103,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] remove InLift
scoreboard players tag @a[x=-104,y=45,z=-1256,dx=-1,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-104,y=45,z=-1258,dx=-1,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-106,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] remove InLift
scoreboard players tag @a[x=-107,y=45,z=-1256,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-107,y=45,z=-1258,dy=liftMaxClearHeight] remove InLift
scoreboard players tag @a[x=-108,y=45,z=-1256,dy=liftMaxClearHeight,dz=-2] remove InLift

scoreboard players tag @a[x=-102,y=45,z=-1257,dy=liftHeight] add InLift
scoreboard players tag @a[x=-107,y=45,z=-1257,dy=liftHeight] add InLift
scoreboard players tag @a[x=-104,y=45,z=-1257,dx=-1,dy=liftHeight] add InLift
scoreboard players tag @a[x=-102,y=45,z=-1257,dy=liftHeight] add InLift
scoreboard players tag @a[x=-107,y=45,z=-1257,dy=liftHeight] add InLift
scoreboard players tag @a[x=-104,y=45,z=-1257,dx=-1,dy=liftHeight] add InLift

particle reddust -102 45 -1257 0.25 8 0.25 0 5 None @a Force
particle reddust -107 45 -1257 0.25 8 0.25 0 5 None @a Force
particle magicCrit -104 45 -1257 0.25 8 0.25 0 10 None @a Force
particle magicCrit -105 45 -1257 0.25 8 0.25 0 10 None @a Force

FUNC enableLifts
	activate(northLift)
	activate(southLift)
END

FUNC disableLifts
	deactivate(northLift)
	deactivate(southLift)
	scoreboard players tag * remove InLift
END

// Control Point Options
DEFINE controlPointRange 4
DEFINE maxControlPointIntegrity 200
DEFINE scoreTarget 1680000

//// Control Points v3.0 ////
FUNC createControlPoint
	summon ArmorStand |1| |2| |3| {Tags:["BiolabControlPoint","BCP|0|"],NoGravity:1b,Marker:1b,Invisible:1b,Invulnerable:1b,PerisistenceRequired:1b,Small:1b}
	USE @e[BCP|0|]
		summon Shulker ~ ~ ~ {CustomName:"Control Point |0|",CustomNameVisible:1b,Tags:["BiolabControlPointVisual","BCP|0|V"],Invulnerable:1b,Glowing:1b,NoAI:1b,PerisistenceRequired:1b}
	UNUSE
	scoreboard players set @e[BCP|0|] BiolabCPI DIV(maxControlPointIntegrity;2)
	scoreboard players set @e[BCP|0|] BiolabCPIS 1
	@e[BCP|0|] setblock ~ ~1 ~ minecraft:stained_glass 0
	scoreboard teams join BiolabCPNeutral @e[BCP|0|]
	scoreboard teams join BiolabCPNeutral @e[BCP|0|V]
END

FUNC enableControlPoints
	scoreboard objectives add BiolabCPI dummy CP Integrity
	scoreboard objectives add BiolabCPIS dummy CP Integrity Status
	scoreboard objectives add BiolabBCP dummy Blink CP
	scoreboard objectives add BiolabCPPC dummy CP Player Count
	scoreboard objectives add BiolabTS dummy Team Scores
	scoreboard players set 20 BiolabTemp 20
	
	createControlPoint(A;-104;67;-1166)
	createControlPoint(B;-75;72;-1174)
	createControlPoint(C;-119;71;-1219)
	createControlPoint(D;-203;44;-1189)
	
	scoreboard teams join BiolabCPBlue Blue_Team
	scoreboard teams join BiolabCPRed Red_Team
	scoreboard teams join BiolabCPPurple Purple_Team
	scoreboard players set Blue_Team BiolabTS 0
	scoreboard players set Red_Team BiolabTS 0
	scoreboard players set Purple_Team BiolabTS 0
	scoreboard objectives setdisplay sidebar BiolabTS
	activate(controlPointUpdateClock)
END

:controlPointUpdateClock CLOCK 16 0 1
// Reset blink
scoreboard players set @e[BiolabControlPoint] BiolabBCP 0

// Reset player presence
scoreboard players set @e[BiolabControlPoint] BiolabCPPC 0

// Detect player presence
@e[BiolabControlPoint] @p[r=controlPointRange,team=BiolabBlue,m=2] scoreboard players add @e[BiolabControlPoint,c=1] BiolabCPPC 1
@e[BiolabControlPoint] @p[r=controlPointRange,team=BiolabRed,m=2] scoreboard players add @e[BiolabControlPoint,c=1] BiolabCPPC 2
@e[BiolabControlPoint] @p[r=controlPointRange,team=BiolabPurple,m=2] scoreboard players add @e[BiolabControlPoint,c=1] BiolabCPPC 4

// Increasing integrity
@e[team=BiolabCPBlue,BiolabCPPC=1,BiolabCPI<maxControlPointIntegrity] BiolabCPI + 1
@e[team=BiolabCPRed,BiolabCPPC=2,BiolabCPI<maxControlPointIntegrity] BiolabCPI + 1
@e[team=BiolabCPPurple,BiolabCPPC=4,BiolabCPI<maxControlPointIntegrity] BiolabCPI + 1

// Decreasing integrity
@e[BiolabCPPC=1,team=!BiolabCPBlue,BiolabCPI>0] BiolabCPI - 1
@e[BiolabCPPC=2,team=!BiolabCPRed,BiolabCPI>0] BiolabCPI - 1
@e[BiolabCPPC=4,team=!BiolabCPPurple,BiolabCPI>0] BiolabCPI - 1

// Blink tags
scoreboard players set @e[BiolabCPPC=1,team=!BiolabCPBlue] BiolabBCP 1
scoreboard players set @e[BiolabCPPC=2,team=!BiolabCPRed] BiolabBCP 1
scoreboard players set @e[BiolabCPPC=4,team=!BiolabCPPurple] BiolabBCP 1

// Ownership checks
scoreboard players tag @e[BiolabCPI=0,team=BiolabCPNeutral,BiolabCPPC=1] add CPtoBlue
scoreboard players tag @e[BiolabCPI=0,team=BiolabCPNeutral,BiolabCPPC=2] add CPtoRed
scoreboard players tag @e[BiolabCPI=0,team=BiolabCPNeutral,BiolabCPPC=4] add CPtoPurple
scoreboard players tag @e[BiolabCPI=0,team=!BiolabCPNeutral] add CPtoNeutral

@e[CPtoBlue] playsound minecraft:entity.experience_orb.touch voice @a[team=BiolabBlue] ~ ~ ~
@e[CPtoBlue] tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"text":"Blue","color":"blue"}," team has captured ",{"selector":"@e[tag=BiolabControlPointVisual,c=1]"},"!"]
@e[CPtoBlue] BiolabCPI = 1
scoreboard teams join BiolabCPBlue @e[CPtoBlue]

@e[CPtoRed] playsound minecraft:entity.experience_orb.touch voice @a[team=BiolabRed] ~ ~ ~
@e[CPtoRed] tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"text":"Red","color":"red"}," team has captured ",{"selector":"@e[tag=BiolabControlPointVisual,c=1]"},"!"]
@e[CPtoRed] BiolabCPI = 1
scoreboard teams join BiolabCPRed @e[CPtoRed]

@e[CPtoPurple] playsound minecraft:entity.experience_orb.touch voice @a[team=BiolabPurple] ~ ~ ~
@e[CPtoPurple] tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"text":"Purple","color":"light_purple"}," team has captured ",{"selector":"@e[tag=BiolabControlPointVisual,c=1]"},"!"]
@e[CPtoPurple] BiolabCPI = 1
scoreboard teams join BiolabCPPurple @e[CPtoPurple]

@e[CPtoNeutral] playsound minecraft:entity.experience_orb.touch voice @a ~ ~ ~
@e[CPtoNeutral] tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ",{"selector":"@e[tag=BiolabControlPointVisual,c=1]"}," has been lost!"]
@e[CPtoNeutral] BiolabCPI = DIV(maxControlPointIntegrity;2)
scoreboard teams join BiolabCPNeutral @e[CPtoNeutral]

scoreboard players tag @e[CPtoBlue] remove CPtoBlue
scoreboard players tag @e[CPtoRed] remove CPtoRed
scoreboard players tag @e[CPtoPurple] remove CPtoPurple
scoreboard players tag @e[CPtoNeutral] remove CPtoNeutral

// CPIS is 2 when more than 50%, 1 when less than or equal to 50%
scoreboard players set @e[BiolabCPI>DIV(maxControlPointIntegrity;2)] BiolabCPIS 2
scoreboard players set @e[BiolabCPI<=DIV(maxControlPointIntegrity;2)] BiolabCPIS 1

// Blinking
@e[BiolabBCP=1] scoreboard players operation @e[BiolabBCP=1,c=1] BiolabTemp = @e[BiolabBCP=1,c=1] BiolabCPI
scoreboard players operation @e[BiolabBCP=1] BiolabTemp %= 20 BiolabTemp
@e[BiolabBCP=1,BiolabTemp=10] playsound minecraft:block.note.pling voice @a ~ ~ ~
USE @e[BiolabBCP=1,BiolabTemp>10] 
	setblock ~ ~1 ~ minecraft:stained_glass 0
	scoreboard teams join BiolabCPNeutral @e[BiolabControlPointVisual,r=1,c=1,team=!BiolabCPNeutral]
UNUSE
scoreboard players set @e[BiolabBCP=1,BiolabTemp<=10] BiolabBCP 0

// Reset visuals
@e[BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=2] setblock ~ ~1 ~ minecraft:stained_glass 11
@e[BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=1] setblock ~ ~1 ~ minecraft:stained_glass 3
@e[BiolabBCP=0,team=BiolabCPBlue] scoreboard teams join BiolabCPBlue @e[BiolabControlPointVisual,r=1,c=1,team=!BiolabCPBlue]

@e[BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=2] setblock ~ ~1 ~ minecraft:stained_glass 14
@e[BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=1] setblock ~ ~1 ~ minecraft:stained_glass 6
@e[BiolabBCP=0,team=BiolabCPRed] scoreboard teams join BiolabCPRed @e[BiolabControlPointVisual,r=1,c=1,team=!BiolabCPRed]

@e[BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=2] setblock ~ ~1 ~ minecraft:stained_glass 10
@e[BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=1] setblock ~ ~1 ~ minecraft:stained_glass 2
@e[BiolabBCP=0,team=BiolabCPPurple] scoreboard teams join BiolabCPPurple @e[BiolabControlPointVisual,r=1,c=1,team=!BiolabCPPurple]

// Inventory indicators
@e[BCPA,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.4 minecraft:stained_glass 1 11
@e[BCPA,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.4 minecraft:stained_glass 1 14
@e[BCPA,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.4 minecraft:stained_glass 1 10
@e[BCPA,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.4 minecraft:stained_glass 1 3
@e[BCPA,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.4 minecraft:stained_glass 1 6
@e[BCPA,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.4 minecraft:stained_glass 1 2

@e[BCPB,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.5 minecraft:stained_glass 1 11
@e[BCPB,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.5 minecraft:stained_glass 1 14
@e[BCPB,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.5 minecraft:stained_glass 1 10
@e[BCPB,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.5 minecraft:stained_glass 1 3
@e[BCPB,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.5 minecraft:stained_glass 1 6
@e[BCPB,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.5 minecraft:stained_glass 1 2

@e[BCPC,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.6 minecraft:stained_glass 1 11
@e[BCPC,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.6 minecraft:stained_glass 1 14
@e[BCPC,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.6 minecraft:stained_glass 1 10
@e[BCPC,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.6 minecraft:stained_glass 1 3
@e[BCPC,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.6 minecraft:stained_glass 1 6
@e[BCPC,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.6 minecraft:stained_glass 1 2

@e[BCPD,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.7 minecraft:stained_glass 1 11
@e[BCPD,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.7 minecraft:stained_glass 1 14
@e[BCPD,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=2] replaceitem entity @a[BiolabPlayer] slot.hotbar.7 minecraft:stained_glass 1 10
@e[BCPD,BiolabBCP=0,team=BiolabCPBlue,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.7 minecraft:stained_glass 1 3
@e[BCPD,BiolabBCP=0,team=BiolabCPRed,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.7 minecraft:stained_glass 1 6
@e[BCPD,BiolabBCP=0,team=BiolabCPPurple,BiolabCPIS=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.7 minecraft:stained_glass 1 2

@e[BCPA] @e[BiolabControlPointVisual,team=BiolabCPNeutral,r=0,c=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.4 minecraft:stained_glass 1 0
@e[BCPB] @e[BiolabControlPointVisual,team=BiolabCPNeutral,r=0,c=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.5 minecraft:stained_glass 1 0
@e[BCPC] @e[BiolabControlPointVisual,team=BiolabCPNeutral,r=0,c=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.6 minecraft:stained_glass 1 0
@e[BCPD] @e[BiolabControlPointVisual,team=BiolabCPNeutral,r=0,c=1] replaceitem entity @a[BiolabPlayer] slot.hotbar.7 minecraft:stained_glass 1 0

// Incrementing team scores
@e[BiolabCPIS=2,team=BiolabCPBlue] Blue_Team BiolabTS + 10
@e[BiolabCPIS=1,team=BiolabCPBlue] Blue_Team BiolabTS + 5

@e[BiolabCPIS=2,team=BiolabCPRed] Red_Team BiolabTS + 10
@e[BiolabCPIS=1,team=BiolabCPRed] Red_Team BiolabTS + 5

@e[BiolabCPIS=2,team=BiolabCPPurple] Purple_Team BiolabTS + 10
@e[BiolabCPIS=1,team=BiolabCPPurple] Purple_Team BiolabTS + 5

// Winner check
scoreboard players set ScoreCalc BiolabTemp 0
scoreboard players test Blue_Team BiolabTS scoreTarget
CONDITION
	ScoreCalc BiolabTemp + 1
scoreboard players test Red_Team BiolabTS scoreTarget
CONDITION
	ScoreCalc BiolabTemp + 2
scoreboard players test Purple_Team BiolabTS scoreTarget
CONDITION
	ScoreCalc BiolabTemp + 4

scoreboard players test ScoreCalc BiolabTemp 1 1
CONDITION
	title @a[BiolabPlayer] title '[{"text":"","color":"green"},{"text":"Blue","color":"blue"}," team has won!"]'

scoreboard players test ScoreCalc BiolabTemp 2 2
CONDITION
	title @a[BiolabPlayer] title '[{"text":"","color":"green"},{"text":"Red","color":"red"}," team has won!"]'

scoreboard players test ScoreCalc BiolabTemp 4 4
CONDITION
	title @a[BiolabPlayer] title '[{"text":"","color":"green"},{"text":"Purple","color":"light_purple"}," team has won!"]'

scoreboard players test ScoreCalc BiolabTemp 3 3
CONDITION
	title @a[BiolabPlayer] title '[{"text":"","color":"green"},{"text":"Blue","color":"blue"}," and ",{"text":"Red","color":"red"}," have tied!"]'

scoreboard players test ScoreCalc BiolabTemp 5 5
CONDITION
	title @a[BiolabPlayer] title '[{"text":"","color":"green"},{"text":"Blue","color":"blue"}," and ",{"text":"Purple","color":"light_purple"}," have tied!"]'

scoreboard players test ScoreCalc BiolabTemp 6 6
CONDITION
	title @a[BiolabPlayer] title '[{"text":"","color":"green"},{"text":"Red","color":"red"}," and ",{"text":"Purple","color":"light_purple"}," have tied!"]'

scoreboard players test ScoreCalc BiolabTemp 7 7
CONDITION
	title @a[BiolabPlayer] title '[{"text":"","color":"green"},"All teams have tied!"]'

scoreboard players test ScoreCalc BiolabTemp 1
CONSTART
	deactivate(controlPointUpdateClock)
	activate(gameEnd)
CONEND

FUNC disableControlPoints
	deactivate(controlPointUpdateClock)
	scoreboard objectives remove BiolabCPI
	scoreboard objectives remove BiolabCPIS
	scoreboard objectives remove BiolabBCP
	scoreboard objectives remove BiolabCPPC
	scoreboard objectives remove BiolabTS
	kill @e[BiolabControlPoint]
	kill @e[BiolabControlPointVisual]
END

// Light Assault Options
DEFINE maximumAirTicks 8000
DEFINE jetpackCooldownTime 2000
DEFINE jetpackStrength 2
DEFINE jetpackRechargeRate 100
DEFINE jetpackDischargeRate 80

//// Light Assault ////
FUNC enableLightAssaultJetpack
	scoreboard objectives add BiolabJC dummy Biolab Jetpack Charge
	scoreboard objectives add BiolabJCP dummy BiolabJC Precision
	scoreboard objectives add BiolabSneakTimer stat.sneakTime Biolab Sneak Timer
	activate(lightAssaultJetpack)
END

:lightAssaultJetpack CLOCK 16 0 1
@a[LightAssault] BiolabJCP + 0

scoreboard players tag @a[LightAssault,BiolabSneakTimer>0] remove JetpackDisabled
scoreboard players tag @a[LightAssault,BiolabSneakTimer>0] add JetpackEnabled
@a[JetpackCooldown,BiolabJCP<jetpackCooldownTime] BiolabSneakTimer = 0
scoreboard players tag @a[BiolabJCP>=jetpackCooldownTime] remove JetpackCooldown

scoreboard players tag @a[LightAssault,BiolabSneakTimer=0] remove JetpackEnabled
@a[LightAssault] @a[!JetpackCooldown,r=0,c=1] @a[!JetpackEnabled,r=0,c=1] @a[!JetpackDisabled,r=0,c=1] @a[!InLift,r=0,c=1] playsound minecraft:block.lava.extinguish voice @a  ~ ~ ~ 0.5
@a[LightAssault] @a[!JetpackCooldown,r=0,c=1] @a[!JetpackEnabled,r=0,c=1] @a[!JetpackDisabled,r=0,c=1] @a[!InLift,r=0,c=1] effect @a[r=0,c=1] minecraft:jump_boost 1 255 true
scoreboard players tag @a[LightAssault,BiolabSneakTimer=0] add JetpackDisabled

scoreboard players tag @a[BiolabJCP=0] remove JetpackEnabled
@a[LightAssault] @a[!JetpackCooldown,r=0,c=1] @a[!JetpackEnabled,r=0,c=1] @a[!JetpackDisabled,r=0,c=1] @a[!InLift,r=0,c=1] playsound minecraft:block.lava.extinguish voice @a  ~ ~ ~ 0.5
@a[LightAssault] @a[!JetpackCooldown,r=0,c=1] @a[!JetpackEnabled,r=0,c=1] @a[!JetpackDisabled,r=0,c=1] @a[!InLift,r=0,c=1] effect @a[r=0,c=1] minecraft:jump_boost 1 255 true
scoreboard players tag @a[BiolabJCP=0] add JetpackDisabled
scoreboard players tag @a[BiolabJCP=0] add JetpackCooldown

@a[JetpackEnabled] @a[!InLift,r=0,c=1] playsound minecraft:entity.player.attack.nodamage voice @a ~ ~ ~ 1 0.5
@a[JetpackEnabled] @a[!InLift,team=BiolabBlue,r=0,c=1] particle reddust ~ ~ ~ -1 0 1 -0.05
@a[JetpackEnabled] @a[!InLift,team=BiolabRed,r=0,c=1] particle reddust ~ ~ ~ 0 0 0 -0.05
@a[JetpackEnabled] @a[!InLift,team=BiolabPurple,r=0,c=1] particle reddust ~ ~ ~ 0 0 1 -0.05

USE @a[LightAssault] @a[!InLift,r=0,c=1]
	effect @p[JetpackDisabled,r=0] minecraft:levitation 0

	effect @p[JetpackEnabled,BiolabJCP>0,r=0] minecraft:levitation 1000000 jetpackStrength true
UNUSE
@a[JetpackEnabled] BiolabJCP - jetpackDischargeRate

@a[LightAssault,BiolabJCP<0] BiolabJCP = 0
@a[BiolabJCP>maximumAirTicks] BiolabJCP = maximumAirTicks
@a[JetpackDisabled,BiolabJCP<maximumAirTicks] BiolabJCP + jetpackRechargeRate
scoreboard players set @a[LightAssault] BiolabSneakTimer 0

@a[LightAssault] BiolabJC = BiolabJCP
@a[LightAssault] BiolabJC / 100
@a[LightAssault] BiolabDPL = BiolabJC

FUNC disableLightAssaultJetpack
	deactivate(lightAssaultJetpack)
	scoreboard objectives remove BiolabSneakTimer
	scoreboard objectives remove BiolabJCP
	scoreboard objectives remove BiolabJC
	scoreboard players tag * remove LightAssault
	scoreboard players tag * remove JetpackEnabled
	scoreboard players tag * remove JetpackDisabled
	scoreboard players tag * remove JetpackCooldown
END

// Infiltrator Options
DEFINE maximumCloakTicks 8000
DEFINE cloakCooldownTime 2000
DEFINE cloakRechargeRate 100
DEFINE cloakDischargeRate 33

//// Infiltrator ////
FUNC enableInfiltratorCloaking
	scoreboard objectives add BiolabCC dummy Biolab Cloak Charge
	scoreboard objectives add BiolabCCP dummy BiolabCC Precision
	scoreboard objectives add BiolabSneakTimer stat.sneakTime Biolab Sneak Timer
	scoreboard objectives add BiolabCOS stat.useItem.minecraft.carrot_on_a_stick Biolab C.o.S.
	scoreboard players set 100 BiolabTemp 100
	activate(infiltratorCloak)
END

:infiltratorCloak CLOCK 16 0 1
scoreboard players tag @a[InFourthSlot] remove InFourthSlot
scoreboard players tag @a[Infiltrator] add InFourthSlot {SelectedItemSlot:3}

scoreboard players tag @a[Infiltrator,BiolabCOS=1] remove CloakDisabled
@a[Infiltrator] @a[!CloakDisabled,r=0,c=1] @a[!CloakEnabled,r=0,c=1] playsound entity.donkey.hurt voice @a ~ ~ ~ 0.5 0.5
scoreboard players tag @a[Infiltrator,BiolabCOS=1] add CloakEnabled
@a[CloakCooldown,BiolabCCP<cloakCooldownTime] BiolabCOS = 0
scoreboard players tag @a[BiolabCCP>=cloakCooldownTime] remove CloakCooldown

scoreboard players tag @a[Infiltrator,BiolabCOS=0] remove CloakEnabled
@a[Infiltrator] @a[!CloakDisabled,r=0,c=1] @a[!CloakEnabled,r=0,c=1] playsound entity.donkey.hurt voice @a ~ ~ ~ 0.5 0.5
scoreboard players tag @a[Infiltrator,BiolabCOS=0] add CloakDisabled

scoreboard players tag @a[BiolabCCP=0] remove CloakEnabled
@a[Infiltrator] @a[!CloakDisabled,r=0,c=1] @a[!CloakEnabled,r=0,c=1] playsound entity.donkey.hurt voice @a ~ ~ ~ 0.5 0.5
scoreboard players tag @a[BiolabCCP=0] add CloakDisabled
scoreboard players tag @a[BiolabCCP=0] add CloakCooldown

USE @a[Infiltrator]
	effect @p[CloakDisabled,r=0] minecraft:invisibility 0
	
	effect @p[CloakEnabled,BiolabSneakTimer>0,r=0] minecraft:invisibility maximumCloakTicks 0 true
	effect @p[CloakEnabled,BiolabSneakTimer=0,r=0] minecraft:invisibility maximumCloakTicks 0 false
UNUSE

replaceitem entity @a[CloakDisabled] slot.hotbar.3 minecraft:carrot_on_a_stick 1 0 {display:{Name:"Cloaking Device",Lore:["Right-click me to cloak!","Select another slot in your hotbar to uncloak."]}}

replaceitem entity @a[CloakDisabled,team=BiolabBlue] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:255},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabBlue] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:255},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabBlue] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:255},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabBlue] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:255},Unbreakable:1}

replaceitem entity @a[CloakDisabled,team=BiolabRed] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711680},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabRed] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:16711680},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabRed] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711680},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabRed] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711680},Unbreakable:1}

replaceitem entity @a[CloakDisabled,team=BiolabPurple] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabPurple] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabPurple] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @a[CloakDisabled,team=BiolabPurple] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711935},Unbreakable:1}

replaceitem entity @a[CloakEnabled] slot.hotbar.3 air
replaceitem entity @a[CloakEnabled] slot.armor.head air
replaceitem entity @a[CloakEnabled] slot.armor.chest air
replaceitem entity @a[CloakEnabled] slot.armor.legs air
replaceitem entity @a[CloakEnabled] slot.armor.feet air
@a[CloakEnabled] BiolabCCP - cloakDischargeRate
@a[CloakEnabled] scoreboard players set @p[!InFourthSlot,r=0] BiolabCOS 0

@a[Infiltrator,BiolabCCP<0] BiolabCCP = 0
@a[Infiltrator,BiolabCCP>maximumCloakTicks] BiolabCCP = maximumCloakTicks
@a[CloakDisabled,BiolabCCP<maximumCloakTicks] BiolabCCP + cloakRechargeRate
scoreboard players set @a[Infiltrator] BiolabSneakTimer 0

@a[Infiltrator] BiolabCC = BiolabCCP
@a[Infiltrator] BiolabCC / 100
@a[Infiltrator] BiolabDPL = BiolabCC

FUNC disableInfiltratorCloaking
	deactivate(infiltratorCloak)
	scoreboard objectives remove BiolabSneakTimer
	scoreboard objectives remove BiolabCOS
	scoreboard objectives remove BiolabCC
	scoreboard objectives remove BiolabCCP
	scoreboard objectives remove BiolabLI
	scoreboard players tag * remove Infiltrator
	scoreboard players tag * remove CloakEnabled
	scoreboard players tag * remove CloakDisabled
	scoreboard players tag * remove CloakCooldown
	scoreboard players tag * remove InFourthSlot
END

// Engineer Options
DEFINE ammoPackRadius 3
DEFINE magazinesGiven 3

//// Engineer ////
FUNC enableEngineerAbilities
	scoreboard objectives add BiolabAPO dummy Ammo Pack Owner
	activate(engineerAbilities)
END

:engineerAbilities CLOCK 16 0 1
scoreboard players add @e[AmmoPack] BiolabAPO 0
entitydata @e[AmmoPack,BiolabAPO=0] {PickupDelay:32767,CustomName:"Ammo Pack",CustomNameVisible:1b}

// MAX repair
@e[Engineer,team=BiolabBlue] effect @p[MAX,team=BiolabBlue,rm=1,r=5] minecraft:regeneration 1 2
@e[Engineer,team=BiolabRed] effect @p[MAX,team=BiolabRed,rm=1,r=5] minecraft:regeneration 1 2
@e[Engineer,team=BiolabPurple] effect @p[MAX,team=BiolabPurple,rm=1,r=5] minecraft:regeneration 1 2

// Ammo Pack Ownership
scoreboard players tag @e[AmmoPack,BiolabAPO=0,c=1] add CurrentAmmoPackCalc
@e[CurrentAmmoPackCalc] scoreboard players tag @p[Engineer] add CurrentEngineerCalc

scoreboard players operation @e[AmmoPack] BiolabAPO -= @p[CurrentEngineerCalc] BiolabPID
kill @e[AmmoPack,BiolabAPO=0]
scoreboard players operation @e[AmmoPack] BiolabAPO += @p[CurrentEngineerCalc] BiolabPID

@p[CurrentEngineerCalc,team=BiolabBlue] scoreboard players tag @e[CurrentAmmoPackCalc] add BlueAmmoPack
@p[CurrentEngineerCalc,team=BiolabRed] scoreboard players tag @e[CurrentAmmoPackCalc] add RedAmmoPack
@p[CurrentEngineerCalc,team=BiolabPurple] scoreboard players tag @e[CurrentAmmoPackCalc] add PurpleAmmoPack

@p[CurrentEngineerCalc,team=BiolabBlue] scoreboard teams join BiolabCPBlue @e[CurrentAmmoPackCalc]
@p[CurrentEngineerCalc,team=BiolabRed] scoreboard teams join BiolabCPRed @e[CurrentAmmoPackCalc]
@p[CurrentEngineerCalc,team=BiolabPurple] scoreboard teams join BiolabCPPurple @e[CurrentAmmoPackCalc]

scoreboard players operation @e[CurrentAmmoPackCalc] BiolabAPO = @p[CurrentEngineerCalc] BiolabPID

scoreboard players tag @e[CurrentEngineerCalc] remove CurrentEngineerCalc
scoreboard players tag @e[CurrentAmmoPackCalc] remove CurrentAmmoPackCalc

// Ammo Pack Supply
replaceitem entity @a[Engineer] slot.hotbar.3 minecraft:stone_slab 1 0 {display:{Name:"Ammo Pack",Lore:["I give players ammo.","Drop me to use!"]}}
@e[BlueAmmoPack] replaceitem entity @a[team=BiolabBlue,r=ammoPackRadius] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
@e[RedAmmoPack] replaceitem entity @a[team=BiolabRed,r=ammoPackRadius] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
@e[PurpleAmmoPack] replaceitem entity @a[team=BiolabPurple,r=ammoPackRadius] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}

FUNC disableEngineerAbilities
	deactivate(engineerAbilities)
	scoreboard objectives remove BiolabAPO
	scoreboard players tag * remove Engineer
END

// Combat Medic Options
DEFINE maximumNanoRegenTicks 40000
DEFINE nanoRegenCooldownTime 2000
DEFINE nanoRegenRechargeRate 100
DEFINE nanoRegenDischargeRate 200
DEFINE nanoRegenRadius 5
DEFINE nanoRegenParticleEffectRadius 2
DEFINE nanoRegenParticleCount 2

//// Combat Medic ////
FUNC enableCombatMedicNanoRegening
	scoreboard objectives add BiolabNRC dummy Nano Regen Charge
	scoreboard objectives add BiolabNRCP dummy BiolabNRC Precision
	scoreboard objectives add BiolabCOS stat.useItem.minecraft.carrot_on_a_stick Biolab C.o.S.
	scoreboard players set 100 BiolabTemp 100
	activate(combatMedicNanoRegen)
END

:combatMedicNanoRegen CLOCK 16 0 1
scoreboard players set @a[CombatMedic,BiolabCOS=2] BiolabCOS 0

scoreboard players tag @a[CombatMedic,BiolabCOS=1] remove NanoRegenDisabled
scoreboard players tag @a[CombatMedic,BiolabCOS=1] add NanoRegenEnabled
@a[NanoRegenCooldown,BiolabNRCP<nanoRegenCooldownTime] BiolabCOS = 0
scoreboard players tag @a[BiolabNRCP>=nanoRegenCooldownTime] remove NanoRegenCooldown

scoreboard players tag @a[CombatMedic,BiolabCOS=0] remove NanoRegenEnabled
scoreboard players tag @a[CombatMedic,BiolabCOS=0] add NanoRegenDisabled

scoreboard players tag @a[BiolabNRCP=0] remove NanoRegenEnabled
scoreboard players tag @a[BiolabNRCP=0] add NanoRegenDisabled
scoreboard players tag @a[BiolabNRCP=0] add NanoRegenCooldown

@a[CombatMedic,team=BiolabBlue] effect @p[!MAX,team=BiolabBlue,rm=1,r=5] minecraft:regeneration 1 2
@a[CombatMedic,team=BiolabRed] effect @p[!MAX,team=BiolabRed,rm=1,r=5] minecraft:regeneration 1 2
@a[CombatMedic,team=BiolabPurple] effect @p[!MAX,team=BiolabPurple,rm=1,r=5] minecraft:regeneration 1 2

USE @a[CombatMedic]
	@p[NanoRegenEnabled,team=BiolabBlue] ~-nanoRegenRadius ~-nanoRegenRadius ~-nanoRegenRadius effect @a[!MAX,dx=nanoRegenRadius,dy=nanoRegenRadius,dz=nanoRegenRadius,team=BiolabBlue] minecraft:regeneration 1 2
	@p[NanoRegenEnabled,team=BiolabRed] ~-nanoRegenRadius ~-nanoRegenRadius ~-nanoRegenRadius effect @a[!MAX,dx=nanoRegenRadius,dy=nanoRegenRadius,dz=nanoRegenRadius,team=BiolabRed] minecraft:regeneration 1 2
	@p[NanoRegenEnabled,team=BiolabPurple] ~-nanoRegenRadius ~-nanoRegenRadius ~-nanoRegenRadius effect @a[!MAX,dx=nanoRegenRadius,dy=nanoRegenRadius,dz=nanoRegenRadius,team=BiolabPurple] minecraft:regeneration 1 2
	@p[NanoRegenEnabled] particle happyVillager ~ ~1 ~ nanoRegenParticleEffectRadius nanoRegenParticleEffectRadius nanoRegenParticleEffectRadius 0 nanoRegenParticleCount
UNUSE
@a[NanoRegenEnabled] BiolabNRCP - nanoRegenDischargeRate

@a[CombatMedic,BiolabNRCP<0] BiolabNRCP = 0
@a[CombatMedic,BiolabNRCP>maximumNanoRegenTicks] BiolabNRCP = maximumNanoRegenTicks
@a[NanoRegenDisabled,BiolabNRCP<maximumNanoRegenTicks] BiolabNRCP + nanoRegenRechargeRate

@a[CombatMedic] BiolabNRC = BiolabNRCP
@a[CombatMedic] BiolabNRC / 100
@a[CombatMedic] BiolabDPL = BiolabNRC

FUNC disableCombatMedicNanoRegening
	deactivate(combatMedicNanoRegen)
	scoreboard objectives remove BiolabCOS
	scoreboard objectives remove BiolabNRC
	scoreboard objectives remove BiolabNRCP
	scoreboard players tag * remove CombatMedic
	scoreboard players tag * remove NanoRegenEnabled
	scoreboard players tag * remove NanoRegenDisabled
	scoreboard players tag * remove NanoRegenCooldown
END

// Heavy Assault Options
DEFINE maximumNaniteShieldTicks 30000
DEFINE naniteShieldCooldownTime 2000
DEFINE naniteShieldRechargeRate 100
DEFINE naniteShieldDischargeRate 80

//// Heavy Assault ////
FUNC enableHeavyAssaultNaniteShielding
	scoreboard objectives add BiolabNSC dummy Nano Regen Charge
	scoreboard objectives add BiolabNSCP dummy BiolabNSC Precision
	scoreboard objectives add BiolabCOS stat.useItem.minecraft.carrot_on_a_stick Biolab C.o.S.
	scoreboard players set 100 BiolabTemp 100
	activate(heavyAssaultNaniteShield)
END

:heavyAssaultNaniteShield CLOCK 16 0 1
scoreboard players set @a[HeavyAssault,BiolabCOS=2] BiolabCOS 0

scoreboard players tag @a[HeavyAssault,BiolabCOS=1] remove NaniteShieldDisabled
scoreboard players tag @a[HeavyAssault,BiolabCOS=1] add NaniteShieldEnabled
@a[NaniteShieldCooldown,BiolabNSCP<naniteShieldCooldownTime] BiolabCOS = 0
scoreboard players tag @a[BiolabNSCP>=naniteShieldCooldownTime] remove NaniteShieldCooldown

scoreboard players tag @a[HeavyAssault,BiolabCOS=0] remove NaniteShieldEnabled
scoreboard players tag @a[HeavyAssault,BiolabCOS=0] add NaniteShieldDisabled

scoreboard players tag @a[BiolabNSCP=0] remove NaniteShieldEnabled
scoreboard players tag @a[BiolabNSCP=0] add NaniteShieldDisabled
scoreboard players tag @a[BiolabNSCP=0] add NaniteShieldCooldown

USE @a[HeavyAssault]
	effect @p[NaniteShieldDisabled,r=0] minecraft:resistance 0
	effect @p[NaniteShieldDisabled,r=0] minecraft:slowness 0
	effect @p[NaniteShieldDisabled,r=0] minecraft:glowing 0
	
	effect @p[NaniteShieldEnabled,r=0] minecraft:glowing 1000000 0
	effect @p[NaniteShieldEnabled,r=0] minecraft:slowness 1000000 1
	effect @p[NaniteShieldEnabled,r=0] minecraft:resistance 1000000 1
UNUSE
@a[NaniteShieldEnabled] BiolabNSCP - naniteShieldDischargeRate

@a[HeavyAssault,BiolabNSCP<0] BiolabNSCP = 0
@a[HeavyAssault,BiolabNSCP>maximumNaniteShieldTicks] BiolabNSCP = maximumNaniteShieldTicks
@a[NaniteShieldDisabled,BiolabNSCP<maximumNaniteShieldTicks] BiolabNSCP + naniteShieldRechargeRate

@a[HeavyAssault] BiolabNSC = BiolabNSCP
@a[HeavyAssault] BiolabNSC / 100
@a[HeavyAssault] BiolabDPL = BiolabNSC

FUNC disableHeavyAssaultNaniteShielding
	deactivate(heavyAssaultNaniteShield)
	scoreboard objectives remove BiolabCOS
	scoreboard objectives remove BiolabNSC
	scoreboard objectives remove BiolabNSCP
	scoreboard players tag * remove HeavyAssault
	scoreboard players tag * remove NaniteShieldEnabled
	scoreboard players tag * remove NaniteShieldDisabled
	scoreboard players tag * remove NaniteShieldCooldown
END

// Options
DEFINE magazinesGiven 3

// Chestplate colors
//  255  , 16711680, 16711935
//  blue ,    red  ,  purple

//// Class Selection /////
:chooseInfiltratorClass PULSE 16 0 1
scoreboard players tag @p[m=2] add Target
scoreboard players tag @p[Target] add Infiltrator
scoreboard players tag @p[Target] add CloakDisabled
scoreboard players set @p[Target] BiolabCCP maximumCloakTicks
clear @p[Target]
replaceitem entity @p[Target] slot.hotbar.0 minecraft:iron_sword 1 0 {display:{Name:"Knife"},Unbreakable:1}
replaceitem entity @p[Target] slot.hotbar.1 minecraft:snowball 16 0 {display:{Name:"Bullets"}}
replaceitem entity @p[Target] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
replaceitem entity @p[Target] slot.hotbar.3 minecraft:carrot_on_a_stick 1 0 {display:{Name:"Cloaking Device",Lore:["Right-click me to cloak!","Select another slot in your hotbar to uncloak."]}}
replaceitem entity @p[Target] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711935},Unbreakable:1}
xp 80L @p[Target]
tellraw @p[Target] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","You have chosen the Infiltrator class!"]
scoreboard players tag @p[Target] remove Target

:chooseLightAssaultClass PULSE 16 0 1
scoreboard players tag @p[m=2] add Target
scoreboard players tag @p[Target] add LightAssault
scoreboard players tag @p[Target] add JetpackDisabled
scoreboard players set @p[Target] BiolabJetCharge maximumAirTicks
clear @p[Target]
replaceitem entity @p[Target] slot.hotbar.0 minecraft:iron_sword 1 0 {display:{Name:"Knife"},Unbreakable:1}
replaceitem entity @p[Target] slot.hotbar.1 minecraft:snowball 16 0 {display:{Name:"Bullets"}}
replaceitem entity @p[Target] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
replaceitem entity @p[Target] slot.hotbar.3 minecraft:paper 1 0 {display:{Name:"Jump Jets",Lore:["Hold your sneak key to activate your jump jets!","Reach heights that no other classes can!"]}}
replaceitem entity @p[Target] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:8421504},Unbreakable:1,ench:[{id:"minecraft:protection",lvl:7}]}
replaceitem entity @p[Target] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711935},Unbreakable:1}
xp 80L @p[Target]
tellraw @p[Target] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","You have chosen the Light Assault class!"]
scoreboard players tag @p[Target] remove Target

:chooseEngineerClass PULSE 16 0 1
scoreboard players tag @p[m=2] add Target
scoreboard players tag @p[Target] add Engineer
clear @p[Target]
replaceitem entity @p[Target] slot.hotbar.0 minecraft:iron_sword 1 0 {display:{Name:"Knife"},Unbreakable:1}
replaceitem entity @p[Target] slot.hotbar.1 minecraft:snowball 16 0 {display:{Name:"Bullets"}}
replaceitem entity @p[Target] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
replaceitem entity @p[Target] slot.hotbar.3 minecraft:stone_slab 1 0 {display:{Name:"Ammo Pack",Lore:["I give players ammo.","Drop me on the ground to use!"]}}
replaceitem entity @p[Target] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:16776960},Unbreakable:1,ench:[{id:"minecraft:protection",lvl:7}]}
replaceitem entity @p[Target] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711935},Unbreakable:1}
tellraw @p[Target] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","You have chosen the Engineer class!"]
scoreboard players tag @p[Target] remove Target

:chooseCombatMedicClass PULSE 16 0 1
scoreboard players tag @p[m=2] add Target
scoreboard players tag @p[Target] add CombatMedic
scoreboard players tag @p[Target] add NanoRegenDisabled
scoreboard players set @p[Target] BiolabNRCP maximumNanoRegenTicks
clear @p[Target]
replaceitem entity @p[Target] slot.hotbar.0 minecraft:iron_sword 1 0 {display:{Name:"Knife"},Unbreakable:1}
replaceitem entity @p[Target] slot.hotbar.1 minecraft:snowball 16 0 {display:{Name:"Bullets"}}
replaceitem entity @p[Target] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
replaceitem entity @p[Target] slot.hotbar.3 minecraft:carrot_on_a_stick 1 0 {display:{Name:"Nano Regen Device",Lore:["Right-click me to toggle an area of effect Regeneration!"]}}
replaceitem entity @p[Target] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:16777215},Unbreakable:1,ench:[{id:"minecraft:protection",lvl:7}]}
replaceitem entity @p[Target] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711935},Unbreakable:1}
xp 400L @p[Target]
tellraw @p[Target] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","You have chosen the Combat Medic class!"]
scoreboard players tag @p[Target] remove Target

:chooseHeavyAssaultClass PULSE 16 0 1
scoreboard players tag @p[m=2] add Target
scoreboard players tag @p[Target] add HeavyAssault
scoreboard players tag @p[Target] add NaniteShieldDisabled
scoreboard players set @p[Target] BiolabNSCP maximumNaniteShieldTicks
clear @p[Target]
replaceitem entity @p[Target] slot.hotbar.0 minecraft:iron_sword 1 0 {display:{Name:"Knife"},Unbreakable:1}
replaceitem entity @p[Target] slot.hotbar.1 minecraft:snowball 16 0 {display:{Name:"Bullets"}}
replaceitem entity @p[Target] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
replaceitem entity @p[Target] slot.hotbar.3 minecraft:carrot_on_a_stick 1 0 {display:{Name:"Nanite Shield Activator",Lore:["Right-click me to toggle your shield!"]}}
replaceitem entity @p[Target] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:172311},Unbreakable:1,ench:[{id:"minecraft:protection",lvl:10}]}
replaceitem entity @p[Target] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711935},Unbreakable:1}
xp 300L @p[Target]
tellraw @p[Target] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","You have chosen the Heavy Assault class!"]
scoreboard players tag @p[Target] remove Target

// TODO: Resource cost for MAXs
:chooseMAXClass PULSE 16 0 1
scoreboard players tag @p[m=2] add Target
scoreboard players tag @p[Target] add MAX
effect @p[Target] minecraft:slowness 1000000 0
clear @p[Target]
replaceitem entity @p[Target] slot.hotbar.0 minecraft:iron_sword 1 0 {display:{Name:"Knife"},Unbreakable:1}
replaceitem entity @p[Target] slot.hotbar.1 minecraft:snowball 16 0 {display:{Name:"Bullets"}}
replaceitem entity @p[Target] slot.hotbar.2 minecraft:prismarine_shard magazinesGiven 0 {display:{Name:"Magazine"}}
replaceitem entity @p[Target] slot.weapon.offhand minecraft:shield 1 0 {Unbreakable:1}
replaceitem entity @p[Target] slot.armor.head minecraft:leather_helmet 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.chest minecraft:leather_chestplate 1 0 {display:{color:0},Unbreakable:1,ench:[{id:"minecraft:protection",lvl:14}]}
replaceitem entity @p[Target] slot.armor.legs minecraft:leather_leggings 1 0 {display:{color:16711935},Unbreakable:1}
replaceitem entity @p[Target] slot.armor.feet minecraft:leather_boots 1 0 {display:{color:16711935},Unbreakable:1}
tellraw @p[Target] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","You have chosen the MAX class!"]
scoreboard players tag @p[Target] remove Target

:deselectClass PULSE 16 0 1
scoreboard players tag @p[m=2] add Target
// Reset Experience
scoreboard players reset @p[Target] BiolabCPL
scoreboard players reset @p[Target] BiolabDPL
scoreboard players reset @p[Target] BiolabLD
// Reset Sneak Timer (Light Assault and Infiltrator)
scoreboard players reset @p[Target] BiolabSneakTimer
// Reset Carrot On A Stick Statistics (Combat Medic, Infiltrator, and Heavy Assault)
scoreboard players reset @p[Target] BiolabCOS
// Reset Light Assault
scoreboard players reset @p[Target] BiolabJC
scoreboard players reset @p[Target] BiolabJCP
scoreboard players tag @p[Target] remove LightAssault
scoreboard players tag @p[Target] remove JetpackEnabled
scoreboard players tag @p[Target] remove JetpackDisabled
scoreboard players tag @p[Target] remove JetpackCooldown
// Reset Infiltrator
scoreboard players reset @p[Target] BiolabCC
scoreboard players reset @p[Target] BiolabLI
scoreboard players tag @p[Target] remove Infiltrator
scoreboard players tag @p[Target] remove CloakEnabled
scoreboard players tag @p[Target] remove CloakDisabled
scoreboard players tag @p[Target] remove CloakCooldown
// Reset Combat Medic
scoreboard players reset @p[Target] BiolabNRC
scoreboard players reset @p[Target] BiolabNRCP
scoreboard players tag @p[Target] remove CombatMedic
scoreboard players tag @p[Target] remove NanoRegenEnabled
scoreboard players tag @p[Target] remove NanoRegenDisabled
scoreboard players tag @p[Target] remove NanoRegenCooldown
// Reset Engineer
scoreboard players tag @p[Target] remove Engineer
scoreboard players operation @e[AmmoPack] BiolabAPO -= @p[Target] BiolabPID
kill @e[AmmoPack,BiolabAPO=0]
scoreboard players operation @e[AmmoPack] BiolabAPO += @p[Target] BiolabPID
// Reset Heavy Assault
scoreboard players reset @p[Target] BiolabNSC
scoreboard players reset @p[Target] BiolabNSCP
scoreboard players tag @p[Target] remove HeavyAssault
scoreboard players tag @p[Target] remove NaniteShieldEnabled
scoreboard players tag @p[Target] remove NaniteShieldDisabled
scoreboard players tag @p[Target] remove NaniteShieldCooldown
// Reset MAX
scoreboard players tag @p[Target] remove MAX
// Finishing touches
effect @p[Target] clear
clear @p[Target]
xp -1000000L @p[Target]
tellraw @p[Target] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","You have deselected your current class."]
scoreboard players tag @p[Target] remove Target

//// Initialization ////
:initialization PULSE 16 0 1
gamerule naturalRegeneration false
scoreboard objectives add BiolabTemp dummy Temporary Biolab Values
enablePID
enableExperienceIndicator
enableLifts
setTeams
enableControlPoints
initializeTeamPlayerCounter
enableWeapons
enableLightAssaultJetpack
enableInfiltratorCloaking
enableCombatMedicNanoRegening
enableEngineerAbilities
enableHeavyAssaultNaniteShielding
activate(forceFields)
activate(teamJoining)

//// Teleporters On ////
:teleportersOn PULSE 16 0 1
enableTeleporters
deactivate(teleportersOn)

//// Game Start ////
:gameStart PULSE 16 0 1
summon AreaEffectCloud ~ ~ ~ {Duration:1201,Tags:["BiolabCountdown"]}
tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Mission begins in 60 seconds."]
activate(gameCountdown)
deactivate(gameStart)

//// Game Loop ////
:gameCountdown CLOCK 16 0 1
testfor @e[BiolabCountdown] {Age:600}
CONDITION
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Mission begins in 30 seconds."]
testfor @e[BiolabCountdown] {Age:800}
CONDITION
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Mission begins in 20 seconds."]
testfor @e[BiolabCountdown] {Age:1000}
CONDITION
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Mission begins in 10 seconds."]
testfor @e[BiolabCountdown] {Age:1100}
CONSTART
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","5"]
	@a[BiolabPlayer] playsound minecraft:block.note.pling voice @p
CONEND
testfor @e[BiolabCountdown] {Age:1120}
CONSTART
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","4"]
	@a[BiolabPlayer] playsound minecraft:block.note.pling voice @p
CONEND
testfor @e[BiolabCountdown] {Age:1140}
CONSTART
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","3"]
	@a[BiolabPlayer] playsound minecraft:block.note.pling voice @p
CONEND
testfor @e[BiolabCountdown] {Age:1160}
CONSTART
	tellraw @a ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","2"]
	@a[BiolabPlayer] playsound minecraft:block.note.pling voice @p
CONEND
testfor @e[BiolabCountdown] {Age:1180}
CONSTART
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","1"]
	@a[BiolabPlayer] playsound minecraft:block.note.pling voice @p
CONEND
testfor @e[BiolabCountdown] {Age:1200}
CONSTART
	tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Begin! The teleporters are now enabled!"]
	@a[BiolabPlayer] playsound minecraft:entity.wither.death voice @p
	activate(teleportersOn)
	deactivate(gameCountdown)
CONEND

//// Game End ////
:gameEnd PULSE 16 0 1
scoreboard players test ScoreCalc BiolabTemp 1 1
CONSTART
	tellraw @a '["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Winning Team: ", {"text":"Blue","color":"blue"}]'
	@a[team=BiolabBlue,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
CONEND

scoreboard players test ScoreCalc BiolabTemp 2 2
CONSTART
	tellraw @a '["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Winning Team: ", {"text":"Red","color":"red"}]'
	@a[team=BiolabRed,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
CONEND

scoreboard players test ScoreCalc BiolabTemp 4 4
CONSTART
	tellraw @a '["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Winning Team: ", {"text":"Purple","color":"light_purple"}]'
	@a[team=BiolabPurple,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
CONEND

scoreboard players test ScoreCalc BiolabTemp 3 3
CONSTART
	tellraw @a '["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Winning Teams: ", {"text":"Blue","color":"blue"}," and ",{"text":"Red","color":"red"}]'
	@a[team=BiolabBlue,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
	@a[team=BiolabRed,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
CONEND

scoreboard players test ScoreCalc BiolabTemp 5 5
CONSTART
	tellraw @a '["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Winning Teams: ", {"text":"Blue","color":"blue"}," and ",{"text":"Purple","color":"light_purple"}]'
	@a[team=BiolabBlue,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
	@a[team=BiolabPurple,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
CONEND

scoreboard players test ScoreCalc BiolabTemp 6 6
CONSTART
	tellraw @a '["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Winning Teams: ", {"text":"Red","color":"red"}," and ",{"text":"Purple","color":"light_purple"}]'
	@a[team=BiolabRed,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
	@a[team=BiolabPurple,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
CONEND

scoreboard players test ScoreCalc BiolabTemp 7 7
CONSTART
	tellraw @a '["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Winning Teams: ", {"text":"Blue","color":"blue"},", ",{"text":"Red","color":"red"},", and ",{"text":"Purple","color":"light_purple"}]'
	@a[team=BiolabBlue,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
	@a[team=BiolabRed,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
	@a[team=BiolabPurple,m=2] summon FireworksRocketEntity ~ ~ ~ {LifeTime:15,FireworksItem:{id:fireworks,Count:1,tag:{Fireworks:{Explosions:[{Type:0,Flicker:0,Trail:1,Colors:[65297],FadeColors:[16777215]}]}}}}
CONEND

tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Blue team players: ",{"selector":"@a[team=BiolabBlue,m=2]"}]
tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Red team players: ",{"selector":"@a[team=BiolabRed,m=2]"}]
tellraw @a[BiolabPlayer] ["",{"text":"[","color":"yellow"},{"text":"Biolab","color":"green"},{"text":"]","color":"yellow"},": ","Purple team players: ",{"selector":"@a[team=BiolabPurple,m=2]"}]

deactivate(gameEnd)

//// Deinitialization ////
:deinitialization PULSE 16 0 1
deactivate(gameCountdown)
deactivate(teamJoining)
deactivate(forceFields)
disableTeleporters
disableControlPoints
deinitializeTeamPlayerCounter
removeTeams
disableLifts
disableWeapons
disableHeavyAssaultNaniteShielding
disableEngineerAbilities
disableCombatMedicNanoRegening
disableInfiltratorCloaking
disableLightAssaultJetpack
disableExperienceIndicator
disablePID
scoreboard objectives remove BiolabTemp
effect @a[x=-3,y=150,z=-1085,dx=-202,dy=-150,dz=-210,m=2] clear
clear @a[x=-3,y=150,z=-1085,dx=-202,dy=-150,dz=-210,m=2]
kill @e[x=-3,y=150,z=-1085,dx=-202,dy=-150,dz=-210,type=!Player]
tp @a[x=-3,y=150,z=-1085,dx=-202,dy=-150,dz=-210,m=2] -120.0 19 -1205.0 0 0
gamerule naturalRegeneration true